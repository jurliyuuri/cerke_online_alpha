(()=>{var e={346(e){e.exports=function(e){return null!=e&&"object"==typeof e}},592(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.toPath=a,o.toPath_=function(e){return"Tam2"===e?`piece_img/${(0,i.getPieceFont)()}/upright/btam`:a(e)};const r=t(7042),n=t(8322),i=t(4316);function a(e){return`piece_img/${(0,i.getPieceFont)()}/${a=e.side,a===n.Side.Downward?"reversed":a===n.Side.Upward?"upright":a}/${t=e.color,t===r.Color.Huok2?"b":t===r.Color.Kok1?"r":t}${o=e.prof,o===r.Profession.Dau2?"dau":o===r.Profession.Gua2?"gua":o===r.Profession.Io?"io":o===r.Profession.Kauk2?"kauk":o===r.Profession.Kaun1?"kaun":o===r.Profession.Kua2?"kua":o===r.Profession.Maun1?"maun":o===r.Profession.Nuak1?"nuak":o===r.Profession.Tuk2?"tuk":o===r.Profession.Uai1?"uai":o}`;var o,t,a}},627(e,o,t){"use strict";var r,n=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(o,t);n&&!("get"in n?!o.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,n)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var o=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[o.length]=t);return o},r(e)},function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t=r(e),a=0;a<t.length;a++)"default"!==t[a]&&n(o,e,t[a]);return i(o,e),o});Object.defineProperty(o,"__esModule",{value:!0}),o.allowMainPolling=o.forbidMainPolling=void 0,o.sendMainPollAndDoEverythingThatFollows=async function e(){if(console.log("poll"),!h())return;const o=await async function(){const e=await(0,u.sendStuffTo)("poll/main","`polling for the opponent's move`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===e.type)throw alert(`sending MainPoll somehow resulted in an error: ${e.why_illegal}`),new Error(`sending MainPoll somehow resulted in an error: ${e.why_illegal}`);return e}();if("NotYetDetermined"===o.type)return await new Promise((e=>setTimeout(e,500*.8093))),void await e();console.log("ding!"),"x-faikleone"!==sessionStorage.lang&&(document.getElementById("opponent_message").textContent=null!=o.message?_.DICTIONARY.ja.tactics[o.message]:""),document.getElementById("opponent_message_linzklar").textContent=null!=o.message?_.TACTICS_LINZKLAR[o.message]:"",E.KRUT_CRUOP&&new Audio("sound/thud.ogg").play();const t=o.content;if(console.log(t),"NonTamMove"===t.type)if(l.GAME_STATE.opponent_has_just_moved_tam=!1,(0,l.back_up_gamestate)(),"SrcDst"===t.data.type){const e=await async function(e){const o=(0,l.fromAbsoluteCoord)(e.src),t=(0,l.fromAbsoluteCoord)(e.dest);return e.water_entry_ciurl?await O(o,t,{water_entry_ciurl:e.water_entry_ciurl}):await O(o,t,{})}(t.data),o=e.piece_moved;l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),t.data.water_entry_ciurl?p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:o,water_ciurl_count:t.data.water_entry_ciurl.filter((e=>e)).length}),piece_capture_comment:(0,g.toPieceCaptureComment)(e.maybe_capture)}):p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:o}),piece_capture_comment:(0,g.toPieceCaptureComment)(e.maybe_capture)})}else if("FromHand"===t.data.type){const e={prof:t.data.prof,color:t.data.color,side:s.Side.Downward};await async function(e,o){const t=l.GAME_STATE.f.hop1zuo1OfDownward.findIndex((o=>o.color===e.color&&o.prof===e.prof));if(-1===t)throw new Error("What should exist in the hand does not exist");const[r]=l.GAME_STATE.f.hop1zuo1OfDownward.splice(t,1),[n,i]=o;if(null!==l.GAME_STATE.f.currentBoard[n][i])throw new Error("Trying to parachute the piece onto an occupied space");const a=document.getElementById(`hop1zuo1OfDownward_${t}`);await(0,d.animateNode)(a,1213.95,{to:(0,c.coordToPieceXY)([n,i]),from:{top:-135,left:(0,c.hop1_zuo1_left_position)({ind:t,list_length:l.GAME_STATE.f.hop1zuo1OfDownward.length})}}),l.GAME_STATE.f.currentBoard[n][i]=r,(0,l.back_up_gamestate)(),console.log("drawField opponent #",24),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[n,i]})}(e,(0,l.fromAbsoluteCoord)(t.data.dest)),l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:e})})}else{if("SrcStepDstFinite"!==t.data.type)throw t.data,new Error("does not happen");{const e=await async function(e){return await I((0,l.fromAbsoluteCoord)(e.src),(0,l.fromAbsoluteCoord)(e.step),(0,l.fromAbsoluteCoord)(e.dest),e.water_entry_ciurl)}(t.data),o=e.piece_moved;l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),t.data.water_entry_ciurl?p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:o,water_ciurl_count:t.data.water_entry_ciurl.filter((e=>e)).length}),piece_capture_comment:(0,g.toPieceCaptureComment)(e.maybe_capture)}):p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:o}),piece_capture_comment:(0,g.toPieceCaptureComment)(e.maybe_capture)})}}else if("TamMove"===t.type)if(l.GAME_STATE.opponent_has_just_moved_tam=!0,(0,l.back_up_gamestate)(),"NoStep"===t.stepStyle)await async function(e,o,t){const r=l.GAME_STATE.f.currentBoard[e[0]][e[1]];if(null===r)throw new Error("src is unoccupied");const n=document.getElementById(`field_piece_${e[0]}_${e[1]}`);await(0,d.animateNode)(n,1213.95,{to:(0,c.coordToPieceXY)(o),from:(0,c.coordToPieceXY)(e)}),l.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[o[0]][o[1]]=r,(0,l.back_up_gamestate)(),console.log("drawField opponent #",25),(0,u.drawField)({focus:null});const i=document.getElementById(`field_piece_${o[0]}_${o[1]}`);await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(i,1213.95,{to:(0,c.coordToPieceXY)(t),from:(0,c.coordToPieceXY)(o)}),l.GAME_STATE.f.currentBoard[o[0]][o[1]]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[t[0]][t[1]]=r,(0,l.back_up_gamestate)(),console.log("drawField opponent #",26),l.GAME_STATE.last_move_focus=[t[0],t[1]],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[t[0],t[1]]})}((0,l.fromAbsoluteCoord)(t.src),(0,l.fromAbsoluteCoord)(t.firstDest),(0,l.fromAbsoluteCoord)(t.secondDest)),l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:"Tam2"})});else if("StepsDuringFormer"===t.stepStyle)await async function(e){const o={src:(0,l.fromAbsoluteCoord)(e.src),firstDest:(0,l.fromAbsoluteCoord)(e.firstDest),secondDest:(0,l.fromAbsoluteCoord)(e.secondDest),step:(0,l.fromAbsoluteCoord)(e.step)};await I(o.src,o.step,o.firstDest),await new Promise((e=>setTimeout(e,242.79))),await O(o.firstDest,o.secondDest,{})}(t),l.GAME_STATE.is_my_turn=!0,p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:"Tam2"})});else{if("StepsDuringLatter"!==t.stepStyle)throw t.stepStyle,new Error("does not happen");await async function(e){const o={src:(0,l.fromAbsoluteCoord)(e.src),firstDest:(0,l.fromAbsoluteCoord)(e.firstDest),secondDest:(0,l.fromAbsoluteCoord)(e.secondDest),step:(0,l.fromAbsoluteCoord)(e.step)};await O(o.src,o.firstDest,{disable_focus:!0}),await new Promise((e=>setTimeout(e,242.79))),await I(o.firstDest,o.step,o.secondDest)}(t),l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),p.push_body_elem_and_display({type:"movement",dat:(0,w.normalMoveToKiarArk)(t,{piece_moved:"Tam2"})})}else{if("InfAfterStep"!==t.type)throw new Error("does not happen");{l.GAME_STATE.opponent_has_just_moved_tam=!1,(0,l.back_up_gamestate)();const e=(async()=>{if(null!=t.finalResult)return t.finalResult;for(;;){const e=await(0,u.sendStuffTo)("poll/inf","`polling for the opponent's afterhalfacceptance`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===e.type)throw new Error("not good!!!");if("NotYetDetermined"!==e.type){if("InfAfterStep"!==e.content.type)throw new Error("nooooooo");return e.content.finalResult}}})(),[o,r]=await async function(e){const[o,t]=e.src,[r,n]=e.step,i=l.GAME_STATE.f.currentBoard[o][t];if(null===i)throw new Error("src is unoccupied");const a=l.GAME_STATE.f.currentBoard[r][n];if(null===a)throw new Error("step is unoccupied");"Tam2"===a&&(await(0,d.animateStepTamLogo)(),await(0,u.animatePunishStepTamAndCheckPerzej)(s.Side.Downward));const _=document.getElementById(`field_piece_${o}_${t}`);await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY_Shifted)(e.step),from:(0,c.coordToPieceXY)(e.src)}),await new Promise((e=>setTimeout(e,242.79))),await async function(e,o,t){(0,d.drawArrow)(e,o),await new Promise((e=>setTimeout(e,2e3*.8093))),(0,y.drawCiurlWithAudio)(t,s.Side.Downward),await new Promise((e=>setTimeout(e,485.58))),(0,d.eraseArrow)()}(e.step,e.plannedDirection,e.stepping_ciurl);const f=await e.finalResult,p=(0,l.fromAbsoluteCoord)(f.dest),m=e.plannedDirection,[E,w]=p,T=l.GAME_STATE.f.currentBoard[E][w];if(null===T||(0,s.coordEq)(e.src,p)){if(f.water_entry_ciurl){if(await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(m),from:(0,c.coordToPieceXY)(e.src)}),await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(f.water_entry_ciurl,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),f.water_entry_ciurl.filter((e=>e)).length<3)return await(0,d.notifyWaterEntryFailure)(),(0,s.coordEq)(p,m)||await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(p),from:(0,c.coordToPieceXY)(e.src)}),console.log("drawField opponent #",14),l.GAME_STATE.last_move_focus=[o,t],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[o,t]}),[f,{piece_moved:i,maybe_capture:null}]}else if(f.thwarted_by_failing_water_entry_ciurl)return await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(m),from:(0,c.coordToPieceXY)(e.src)}),await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(f.thwarted_by_failing_water_entry_ciurl,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),await(0,d.notifyWaterEntryFailure)(),(0,s.coordEq)(p,m)||await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(p),from:(0,c.coordToPieceXY)(e.src)}),console.log("drawField opponent #",14.5),l.GAME_STATE.last_move_focus=[o,t],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[o,t]}),[f,{piece_moved:i,maybe_capture:null}];return(0,s.coordEq)(e.src,p)||(l.GAME_STATE.f.currentBoard[o][t]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[E][w]=i,(0,l.back_up_gamestate)()),console.log("drawField opponent #",15),l.GAME_STATE.last_move_focus=[E,w],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[E,w]}),[f,{piece_moved:i,maybe_capture:null}]}if(f.water_entry_ciurl){const r=document.getElementById(`field_piece_${E}_${w}`);if(await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(m),from:(0,c.coordToPieceXY)(e.src)}),await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(r,606.975,{to:S(),from:(0,c.coordToPieceXY)([E,w])},"50",180),await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(f.water_entry_ciurl,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),f.water_entry_ciurl.filter((e=>e)).length<3)return await(0,d.notifyWaterEntryFailure)(),(0,s.coordEq)(p,m)||await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(p),from:(0,c.coordToPieceXY)(e.src)}),console.log("drawField opponent #",12),l.GAME_STATE.last_move_focus=[o,t],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[o,t]}),[f,{piece_moved:i,maybe_capture:null}]}else{const o=document.getElementById(`field_piece_${E}_${w}`);await(0,d.animateNode)(_,606.975,{to:(0,c.coordToPieceXY)(p),from:(0,c.coordToPieceXY)(e.src)}),await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(o,606.975,{to:S(),from:(0,c.coordToPieceXY)([E,w])},"50",180)}return(0,s.coordEq)(e.src,p)||(b(T),l.GAME_STATE.f.currentBoard[o][t]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[E][w]=i,(0,l.back_up_gamestate)()),console.log("drawField opponent #",13),l.GAME_STATE.last_move_focus=[E,w],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[E,w]}),[f,{piece_moved:i,maybe_capture:(0,g.toColorProf)(T)}]}({src:(0,l.fromAbsoluteCoord)(t.src),step:(0,l.fromAbsoluteCoord)(t.step),plannedDirection:(0,l.fromAbsoluteCoord)(t.plannedDirection),stepping_ciurl:t.stepping_ciurl,finalResult:e}),n=(()=>{if("Tam2"===r.piece_moved)throw new Error("Tam2 was passed to `piece_moved`");return(0,w.serializeProf)(r.piece_moved.prof)})();if(l.GAME_STATE.is_my_turn=!0,(0,l.back_up_gamestate)(),o.water_entry_ciurl)o.water_entry_ciurl.filter((e=>e)).length<3?p.push_body_elem_and_display({type:"movement",dat:`${(0,w.serializeAbsoluteCoord)(t.src)}${n}${(0,w.serializeAbsoluteCoord)(t.step)}${(0,w.serializeAbsoluteCoord)(o.dest)}橋${(0,w.serializeCiurl)(t.stepping_ciurl)}水${(0,w.serializeCiurl)(o.water_entry_ciurl)}此無`}):p.push_body_elem_and_display({type:"movement",dat:`${(0,w.serializeAbsoluteCoord)(t.src)}${n}${(0,w.serializeAbsoluteCoord)(t.step)}${(0,w.serializeAbsoluteCoord)(o.dest)}橋${(0,w.serializeCiurl)(t.stepping_ciurl)}水${(0,w.serializeCiurl)(o.water_entry_ciurl)}`,piece_capture_comment:(0,g.toPieceCaptureComment)(r.maybe_capture)});else if(o.thwarted_by_failing_water_entry_ciurl)p.push_body_elem_and_display({type:"movement",dat:`${(0,w.serializeAbsoluteCoord)(t.src)}${n}${(0,w.serializeAbsoluteCoord)(t.step)}${(0,w.serializeAbsoluteCoord)(o.dest)}橋${(0,w.serializeCiurl)(t.stepping_ciurl)}水${(0,w.serializeCiurl)(o.thwarted_by_failing_water_entry_ciurl)}此無`,piece_capture_comment:(0,g.toPieceCaptureComment)(r.maybe_capture)});else{const e=(e,o)=>e[0]===o[0]&&e[1]===o[1];e(t.plannedDirection,o.dest)||!e(o.dest,t.src)?p.push_body_elem_and_display({type:"movement",dat:`${(0,w.serializeAbsoluteCoord)(t.src)}${n}${(0,w.serializeAbsoluteCoord)(t.step)}${(0,w.serializeAbsoluteCoord)(o.dest)}橋${(0,w.serializeCiurl)(t.stepping_ciurl)}`,piece_capture_comment:(0,g.toPieceCaptureComment)(r.maybe_capture)}):p.push_body_elem_and_display({type:"movement",dat:`${(0,w.serializeAbsoluteCoord)(t.src)}${n}${(0,w.serializeAbsoluteCoord)(t.step)}${(0,w.serializeAbsoluteCoord)(t.plannedDirection)}橋${(0,w.serializeCiurl)(t.stepping_ciurl)}此無`,piece_capture_comment:(0,g.toPieceCaptureComment)(r.maybe_capture)})}}}};const s=t(8322),l=t(5562),c=t(2443),u=t(5746),d=t(8549),_=t(7630),f=t(3075),p=a(t(8442)),m=t(9784),E=t(4068),w=t(6418),g=t(1493),y=t(7927),T=t(5885),{forbidMainPolling:A,isMainPollingAllowed:h,allowMainPolling:v}=(()=>{let e=!0;return{forbidMainPolling:()=>{e=!1},isMainPollingAllowed:()=>e,allowMainPolling:()=>{e=!0}}})();function S(){return l.GAME_STATE.f.hop1zuo1OfDownward.length<=8?{top:-135,left:1+l.GAME_STATE.f.hop1zuo1OfDownward.length*c.BOX_SIZE+(c.MAX_PIECE_SIZE-c.PIECE_SIZE)/2}:{top:-135,left:1+9*c.BOX_SIZE+(c.MAX_PIECE_SIZE-c.PIECE_SIZE)/2}}function b(e){const o=(()=>{if("Tam2"===e)throw new Error("tried to convert Tam2 into downward");if(e.side===s.Side.Downward)throw new Error("tried to convert an already downward piece to downward");if(e.side===s.Side.Upward)return{color:e.color,prof:e.prof,side:s.Side.Downward};throw e.side,new Error("should not reach here")})(),t=(0,u.calculateHandsAndScore)(l.GAME_STATE.f.hop1zuo1OfDownward);l.GAME_STATE.f.hop1zuo1OfDownward.push(o),(0,l.back_up_gamestate)();const r=(0,u.calculateHandsAndScore)(l.GAME_STATE.f.hop1zuo1OfDownward);r.score!==t.score&&((0,T.add_cover)("protective_cover_over_field_while_waiting_for_opponent"),(0,T.add_cover)("protective_cover_over_field_while_asyncawait"),window.setTimeout((async()=>{await P(r)}),0),window.setTimeout((()=>{(0,f.drawScoreDisplay)(r.hands)}),1e3*.8093))}async function P(e){const o=e.score;console.log("poll whether ty mok1 or ta xot1");const t=await(0,u.sendStuffTo)("poll/whethertymok","`polling for whether the declaration is ty mok1 or ta xot1`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===t.type)throw alert(`sending TyMok1OrTaXot1Poll somehow resulted in an error: ${t.why_illegal}`),new Error(`sending TyMok1OrTaXot1Poll somehow resulted in an error: ${t.why_illegal}`);if("NotYetDetermined"!==t.type){console.log("ding!");const r=document.getElementById("score_display");for(await new Promise((e=>setTimeout(e,242.79)));!r.hasChildNodes();)await new Promise((e=>setTimeout(e,80.93)));if("TyMok"===t.type)r.innerHTML+='<img src="image/再行.png" style="position: absolute; left: 660px; top: 125px; " height="200">',await new Promise((e=>setTimeout(e,4046.5))),console.log("go on with ty mok1"),(0,u.increaseRateAndAnimate)(!1),p.push_body_elem_and_display({type:"tymoktaxot",dat:`或為${e.hands.join("加")}\n再行`});else{r.innerHTML+='<img src="image/終季.png" style="position: absolute; left: 660px; top: 125px; " height="200">',await new Promise((e=>setTimeout(e,4046.5))),console.log("go on with ta xot1");const n=["春","夏","秋","冬"][l.GAME_STATE.season];(0,u.endSeason)(-o,t.is_first_move_my_move),p.push_body_elem_and_display({type:"tymoktaxot",dat:`或為${e.hands.join("加")}而手${(0,m.toDigitsLinzklar)(o*Math.pow(2,l.GAME_STATE.log2_rate)).join("")}\n終季\t${n}終`})}}else(0,T.add_cover)("protective_cover_over_field_while_waiting_for_opponent"),await new Promise((e=>setTimeout(e,500*.8093))),await P(e)}async function I(e,o,t,r){const[n,i]=e,[a,_]=o,[f,p]=t,m=l.GAME_STATE.f.currentBoard[n][i];if(null===m)throw new Error("src is unoccupied");const E=l.GAME_STATE.f.currentBoard[a][_];if(null===E)throw new Error("step is unoccupied");"Tam2"===E&&(await(0,d.animateStepTamLogo)(),await(0,u.animatePunishStepTamAndCheckPerzej)(s.Side.Downward));const w=l.GAME_STATE.f.currentBoard[f][p];if(null===w||(0,s.coordEq)(e,t)){const a=document.getElementById(`field_piece_${n}_${i}`);return await(0,d.animateNode)(a,606.975,{to:(0,c.coordToPieceXY_Shifted)(o),from:(0,c.coordToPieceXY)(e)}),await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(a,606.975,{to:(0,c.coordToPieceXY)(t),from:(0,c.coordToPieceXY)(e)}),r&&(await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(r,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),r.filter((e=>e)).length<3)?(await(0,d.notifyWaterEntryFailure)(),console.log("drawField opponent #",18),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[n,i]}),{piece_moved:m,maybe_capture:null}):((0,s.coordEq)(e,t)||(l.GAME_STATE.f.currentBoard[n][i]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[f][p]=m,(0,l.back_up_gamestate)()),console.log("drawField opponent #",19),l.GAME_STATE.last_move_focus=[f,p],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[f,p]}),{piece_moved:m,maybe_capture:(0,s.coordEq)(e,t)?null:(0,g.toColorProf)(w)})}{const a=document.getElementById(`field_piece_${n}_${i}`),_=document.getElementById(`field_piece_${f}_${p}`);return await(0,d.animateNode)(a,606.975,{to:(0,c.coordToPieceXY_Shifted)(o),from:(0,c.coordToPieceXY)(e)}),await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(a,606.975,{to:(0,c.coordToPieceXY)(t),from:(0,c.coordToPieceXY)(e)}),await new Promise((e=>setTimeout(e,242.79))),await(0,d.animateNode)(_,606.975,{to:S(),from:(0,c.coordToPieceXY)([f,p])},"50",180),r&&(await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(r,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),r.filter((e=>e)).length<3)?(await(0,d.notifyWaterEntryFailure)(),console.log("drawField opponent #",16),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[n,i]}),{piece_moved:m,maybe_capture:null}):((0,s.coordEq)(e,t)||(b(w),l.GAME_STATE.f.currentBoard[n][i]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[f][p]=m,(0,l.back_up_gamestate)()),console.log("drawField opponent #",17),l.GAME_STATE.last_move_focus=[f,p],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[f,p]}),{piece_moved:m,maybe_capture:(0,s.coordEq)(e,t)?null:(0,g.toColorProf)(w)})}}async function O(e,o,t){const[r,n]=e,[i,a]=o,_=l.GAME_STATE.f.currentBoard[r][n];if(null===_)throw new Error("src is unoccupied");const f=l.GAME_STATE.f.currentBoard[i][a];if(null!==f){const e=document.getElementById(`field_piece_${r}_${n}`),o=document.getElementById(`field_piece_${i}_${a}`),p=606.975;if(await(0,d.animateNode)(e,p,{to:(0,c.coordToPieceXY)([i,a]),from:(0,c.coordToPieceXY)([r,n])}),await(0,d.animateNode)(o,p,{to:S(),from:(0,c.coordToPieceXY)([i,a])},"50",180),t.water_entry_ciurl&&(await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(t.water_entry_ciurl,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),t.water_entry_ciurl.filter((e=>e)).length<3))return await(0,d.notifyWaterEntryFailure)(),console.log("drawField opponent #",20),l.GAME_STATE.last_move_focus=[r,n],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[r,n]}),{piece_moved:_,maybe_capture:null};b(f),l.GAME_STATE.f.currentBoard[r][n]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[i][a]=_,(0,l.back_up_gamestate)(),console.log("drawField opponent #",21),l.GAME_STATE.last_move_focus=[i,a],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[i,a]})}else{const e=document.getElementById(`field_piece_${r}_${n}`);if(await(0,d.animateNode)(e,1213.95,{to:(0,c.coordToPieceXY)([i,a]),from:(0,c.coordToPieceXY)([r,n])}),t.water_entry_ciurl&&(await(0,d.animateWaterEntryLogo)(),(0,y.drawCiurlWithAudio)(t.water_entry_ciurl,s.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),t.water_entry_ciurl.filter((e=>e)).length<3))return await(0,d.notifyWaterEntryFailure)(),console.log("drawField opponent #",22),l.GAME_STATE.last_move_focus=[r,n],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[r,n]}),{piece_moved:_,maybe_capture:null};l.GAME_STATE.f.currentBoard[r][n]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[i][a]=_,(0,l.back_up_gamestate)(),t.disable_focus?(0,u.drawField)({focus:null}):(console.log("drawField opponent #",23),l.GAME_STATE.last_move_focus=[i,a],(0,l.back_up_gamestate)(),(0,u.drawField)({focus:[i,a]}))}return{piece_moved:_,maybe_capture:(0,g.toColorProf)(f)}}o.forbidMainPolling=A,o.allowMainPolling=v},659(e,o,t){var r=t(1873),n=Object.prototype,i=n.hasOwnProperty,a=n.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var o=i.call(e,s),t=e[s];try{e[s]=void 0;var r=!0}catch(e){}var n=a.call(e);return r&&(o?e[s]=t:delete e[s]),n}},1168(e,o){"use strict";function t(e){return null===e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntNull=o.isNull=void 0,o.isNull=t,o.isntNull=function(e){return!t(e)}},1316(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isntAsyncIterable=o.isAsyncIterable=void 0;const r=t(1168),n=t(8065),i=t(4761);function a(e){return(0,r.isntNull)(e)&&(0,n.isntUndefined)(e)&&(0,i.isFunction)(e[Symbol.asyncIterator])}o.isAsyncIterable=a,o.isntAsyncIterable=function(e){return!a(e)}},1331(e,o,t){var r=t(2552),n=t(8879),i=t(346),a=Function.prototype,s=Object.prototype,l=a.toString,c=s.hasOwnProperty,u=l.call(Object);e.exports=function(e){if(!i(e)||"[object Object]"!=r(e))return!1;var o=n(e);if(null===o)return!0;var t=c.call(o,"constructor")&&o.constructor;return"function"==typeof t&&t instanceof t&&l.call(t)==u}},1451(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isntJsonable=o.isJsonable=o.isntJson=o.isJson=void 0;const r=t(1168),n=t(2421),i=t(3296),a=t(9172),s=t(2664),l=t(1506);function c(e){return(0,r.isNull)(e)||(0,n.isBoolean)(e)||(0,i.isString)(e)||(0,a.isNumber)(e)||(0,s.isArray)(e)&&e.every(c)||(0,l.isPlainObject)(e)&&Object.values(e).every(c)}o.isJson=c,o.isntJson=function(e){return!c(e)},o.isJsonable=function(e){try{return JSON.stringify(e),!0}catch(e){return!1}},o.isntJsonable=function e(o){return!e(o)}},1493(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.toColorProf=function(e){if("Tam2"===e)throw new Error("Tam2 was passed to the function `toColorProf`");return null===e?null:[e.color,e.prof]},o.toPieceCaptureComment=function(e){if(null===e)return"";const[o,t]=e;return`手${(0,r.serializeColor)(o)}${(0,r.serializeProf)(t)}`};const r=t(6418)},1506(e,o,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.isntEmptyObject=o.isEmptyObject=o.isntPlainObject=o.isPlainObject=o.isntObject=o.isObject=void 0;const n=r(t(1331));function i(e){return null!==e&&"object"==typeof e}function a(e){return(0,n.default)(e)}o.isObject=i,o.isntObject=function(e){return!i(e)},o.isPlainObject=a,o.isntPlainObject=function(e){return!a(e)},o.isEmptyObject=function(e){return 0===Object.keys(e).length},o.isntEmptyObject=function(e){return 0!==Object.keys(e).length}},1848(e,o,t){"use strict";t.r(o),t.d(o,{NodeType:()=>y,XPathResultType:()=>ee,createDOMParser:()=>re,filter:()=>u,find:()=>E,findInAncestorNodes:()=>M,findInDescendantNodes:()=>m,findInFollowingSiblingNodes:()=>k,findInPrecedingSiblingNodes:()=>N,flatMap:()=>l,getAllBySelector:()=>O,getBySelector:()=>I,isAfter:()=>te,isBefore:()=>oe,isDocument:()=>P,isElement:()=>A,isNode:()=>Z,isParentNode:()=>J,isTextNode:()=>h,isntDocument:()=>Y,isntElement:()=>H,isntNode:()=>W,isntParentNode:()=>Q,isntTextNode:()=>q,map:()=>c,nextElementSibling:()=>x,nextSibling:()=>j,normalize:()=>S,parentNode:()=>L,parse:()=>w,previousElementSibling:()=>X,previousSibling:()=>z,removeAllChildren:()=>s,removeAttributes:()=>b,stringify:()=>v,traverseAncestorNodes:()=>C,traverseDescendantNodes:()=>f,unwrap:()=>_});const r="Node"in globalThis;var n;function i(e){return e.cloneNode(!0)}function a(e){return e.map((e=>i(e)))}function s(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function l(e,o){return a(o(i(e))).map((e=>{const t=[];for(const r of e.childNodes)t.push(...a(l(r,o)));return s(e),function(e,o){e.forEach((e=>o.appendChild(e)))}(t,e),e}))}function c(e,o){const t=i(o(i(e)));for(const e of t.childNodes)t.replaceChild(c(e,o),e);return t}function u(e,o){const t=l(e,(e=>o(e)?[e]:[]));if(1===t.length)return t[0]}function d(e){return Array.from(e)}function _(e,o){return l(e,(e=>o(e)?function(e,...o){let t=e;for(const e of o)t=e(t);return t}(e.childNodes,(e=>function*(e,o){for(const t of e)yield*o(t)}(e,(e=>_(e,o)))),d):[e]))}function*f(e){for(const o of e.childNodes)yield o,yield*f(o)}function p(e,o){let t=0;for(const r of e){if(o(r,t))return r;t++}}function m(e,o){return p(f(e),(e=>o(e)))}function E(e,o){return o(e)?e:m(e,o)}function w(e){const o=document.createElement("div");return o.innerHTML=e,[...o.childNodes]}!function(e){e[e.DOCUMENT_POSITION_DISCONNECTED=r?globalThis.Node.DOCUMENT_POSITION_DISCONNECTED:1]="DOCUMENT_POSITION_DISCONNECTED",e[e.DOCUMENT_POSITION_PRECEDING=r?globalThis.Node.DOCUMENT_POSITION_PRECEDING:2]="DOCUMENT_POSITION_PRECEDING",e[e.DOCUMENT_POSITION_FOLLOWING=r?globalThis.Node.DOCUMENT_POSITION_FOLLOWING:4]="DOCUMENT_POSITION_FOLLOWING",e[e.DOCUMENT_POSITION_CONTAINS=r?globalThis.Node.DOCUMENT_POSITION_CONTAINS:8]="DOCUMENT_POSITION_CONTAINS",e[e.DOCUMENT_POSITION_CONTAINED_BY=r?globalThis.Node.DOCUMENT_POSITION_CONTAINED_BY:16]="DOCUMENT_POSITION_CONTAINED_BY",e[e.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=r?globalThis.Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32]="DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC"}(n=n||(n={}));const g="Node"in globalThis;var y;!function(e){e[e.ELEMENT_NODE=g?globalThis.Node.ELEMENT_NODE:1]="ELEMENT_NODE",e[e.ATTRIBUTE_NODE=g?globalThis.Node.ATTRIBUTE_NODE:2]="ATTRIBUTE_NODE",e[e.TEXT_NODE=g?globalThis.Node.TEXT_NODE:3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=g?globalThis.Node.CDATA_SECTION_NODE:4]="CDATA_SECTION_NODE",e[e.ENTITY_REFERENCE_NODE=g?globalThis.Node.ENTITY_REFERENCE_NODE:5]="ENTITY_REFERENCE_NODE",e[e.ENTITY_NODE=g?globalThis.Node.ENTITY_NODE:6]="ENTITY_NODE",e[e.PROCESSING_INSTRUCTION_NODE=g?globalThis.Node.PROCESSING_INSTRUCTION_NODE:7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=g?globalThis.Node.COMMENT_NODE:8]="COMMENT_NODE",e[e.DOCUMENT_NODE=g?globalThis.Node.DOCUMENT_NODE:9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=g?globalThis.Node.DOCUMENT_TYPE_NODE:10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=g?globalThis.Node.DOCUMENT_FRAGMENT_NODE:11]="DOCUMENT_FRAGMENT_NODE",e[e.NOTATION_NODE=g?globalThis.Node.NOTATION_NODE:12]="NOTATION_NODE"}(y=y||(y={}));var T=t(9673);function A(e){return"HTMLElement"in globalThis&&e instanceof HTMLElement||(0,T.isObject)(e)&&e.nodeType===y.ELEMENT_NODE}function h(e){return"Text"in globalThis&&e instanceof Text||(0,T.isObject)(e)&&e.nodeType===y.TEXT_NODE}function v(e){return e.map((e=>A(e)?e.outerHTML:h(e)?e.textContent:"")).join("")}function S(e){return v(w(e))}function b(e,o){if(e instanceof Element){const t=Array.from(e.attributes).map((e=>e.name));for(const r of t)o(r)&&e.removeAttribute(r)}}function P(e){return"HTMLDocument"in globalThis&&e instanceof HTMLDocument||(0,T.isObject)(e)&&e.nodeType===y.DOCUMENT_NODE}function I(e){const o=(A(this)||P(this)?this:document).querySelector(e);if(o)return o;throw new Error(`Could not find any elements matching ${e}`)}function O(e){const o=(A(this)||P(this)?this:document).querySelectorAll(e);if(o.length)return Array.from(o);throw new Error(`Could not find any elements matching ${e}`)}function*C(e){const o=e.parentNode;o&&(yield o,yield*C(o))}function M(e,o){return p(C(e),(e=>o(e)))}function k(e,o){const t=e.nextSibling;if(t)return o(t)?t:k(t,o)}function N(e,o){const t=e.previousSibling;if(t)return o(t)?t:N(t,o)}function D(e){return e instanceof Error}function*B(e){var o;if(D(e))for(const t of function*(e){let o=e;for(;(o=Object.getPrototypeOf(o))&&(yield o,o!==Error.prototype););}(e))(null===(o=t.constructor)||void 0===o?void 0:o.name)&&(yield t.constructor.name);else yield e.name,yield*e.ancestors}class G extends Error{get name(){var e,o;return null!==(o=null!==(e=function(e){for(const o of e)return o}(B(this)))&&void 0!==e?e:G.name)&&void 0!==o?o:"CustomError"}static[Symbol.hasInstance](e){var o,t,r;if(D(e)||(r=e,(0,T.isObject)(r)&&(0,T.isString)(r.name)&&(0,T.isString)(r.message)&&((0,T.isString)(r.stack)||(0,T.isNull)(r.stack))&&(0,T.isArray)(r.ancestors)&&r.ancestors.every(T.isString))){const r=[null!==(o=this.prototype.constructor.name)&&void 0!==o?o:this.name,...B(this.prototype)].reverse(),n=(t=B(e),Array.from(t)).reverse();return r.every(((e,o)=>e===n[o]))}return!1}}class R extends G{}function $(e,o="Assertion failed"){if(!e)throw new R(o)}function L(e,o=1){return $(Number.isInteger(o),"parameter distance must be an integer"),$(o>=1,"parameter distance must be greater than or equal to 1"),U(e,o)}function U(e,o){const t=e.parentNode;if(t)return 1===o?t:U(t,o-1)}function j(e,o=1){return $(Number.isInteger(o),"parameter distance must be an integer"),$(o>=1,"parameter distance must be greater than or equal to 1"),K(e,o)}function K(e,o){const t=e.nextSibling;if(t)return 1===o?t:K(t,o-1)}function z(e,o=1){return $(Number.isInteger(o),"parameter distance must be an integer"),$(o>=1,"parameter distance must be greater than or equal to 1"),function e(o,t=1){const r=o.previousSibling;if(r)return 1===t?r:e(r,t-1)}(e,o)}function x(e,o=1){return $(Number.isInteger(o),"parameter distance must be an integer"),$(o>=1,"parameter distance must be greater than or equal to 1"),F(e,o)}function F(e,o){const t=e.nextSibling;if(t)return A(t)?1===o?t:F(t,o-1):F(t,o)}function X(e,o=1){return $(Number.isInteger(o),"parameter distance must be an integer"),$(o>=1,"parameter distance must be greater than or equal to 1"),function e(o,t=1){const r=o.previousSibling;if(r)return A(r)?1===t?r:e(r,t-1):e(r,t)}(e,o)}function Y(e){return!P(e)}function H(e){return!A(e)}function Z(e){return"Node"in globalThis&&e instanceof Node||(0,T.isObject)(e)&&"nodeType"in e}function W(e){return!Z(e)}function q(e){return!h(e)}function J(e){return Z(e)&&"children"in e}function Q(e){return!J(e)}const V="XPathResult"in globalThis;var ee;function oe(e,o){return!!(e.compareDocumentPosition(o)&n.DOCUMENT_POSITION_FOLLOWING)}function te(e,o){return!!(e.compareDocumentPosition(o)&n.DOCUMENT_POSITION_PRECEDING)}function re(){return new DOMParser}!function(e){e[e.ANY_TYPE=V?globalThis.XPathResult.ANY_TYPE:0]="ANY_TYPE",e[e.NUMBER_TYPE=V?globalThis.XPathResult.NUMBER_TYPE:1]="NUMBER_TYPE",e[e.STRING_TYPE=V?globalThis.XPathResult.STRING_TYPE:2]="STRING_TYPE",e[e.BOOLEAN_TYPE=V?globalThis.XPathResult.BOOLEAN_TYPE:3]="BOOLEAN_TYPE",e[e.UNORDERED_NODE_ITERATOR_TYPE=V?globalThis.XPathResult.UNORDERED_NODE_ITERATOR_TYPE:4]="UNORDERED_NODE_ITERATOR_TYPE",e[e.ORDERED_NODE_ITERATOR_TYPE=V?globalThis.XPathResult.ORDERED_NODE_ITERATOR_TYPE:5]="ORDERED_NODE_ITERATOR_TYPE",e[e.UNORDERED_NODE_SNAPSHOT_TYPE=V?globalThis.XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE:6]="UNORDERED_NODE_SNAPSHOT_TYPE",e[e.ORDERED_NODE_SNAPSHOT_TYPE=V?globalThis.XPathResult.ORDERED_NODE_SNAPSHOT_TYPE:7]="ORDERED_NODE_SNAPSHOT_TYPE",e[e.ANY_UNORDERED_NODE_TYPE=V?globalThis.XPathResult.ANY_UNORDERED_NODE_TYPE:8]="ANY_UNORDERED_NODE_TYPE",e[e.FIRST_ORDERED_NODE_TYPE=V?globalThis.XPathResult.FIRST_ORDERED_NODE_TYPE:9]="FIRST_ORDERED_NODE_TYPE"}(ee=ee||(ee={}))},1873(e,o,t){var r=t(9325).Symbol;e.exports=r},1892(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.initial_board_with_IA_down=void 0;const r=t(3218),n=t(7042);o.initial_board_with_IA_down=[[{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Io,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Downward}],[{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Downward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Downward}],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Nuak1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward}],[null,null,null,null,null,null,null,null,null],[null,null,null,null,"Tam2",null,null,null,null],[null,null,null,null,null,null,null,null,null],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Nuak1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward}],[{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Upward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Upward}],[{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Io,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Upward}]]},2167(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createBapPokImage=function(e){const o=document.createElement("img");return o.src="image/dat2/同色.png",o.style.position="absolute",o.style.left=`${e.left}px`,o.style.top=`${185+e.top_padding}px`,o.width=50,o},o.createHandImage=function(e,o){const t=document.createElement("img");return t.src=`image/dat2/${e}.png`,t.style.position="absolute",t.style.left=`${o.left}px`,t.style.top=`${o.top_padding}px`,t.width=50,t},o.createArrowSvg=function(e,o){const[t,r]=o,i=t*n.BOX_SIZE+160.5,a=r*n.BOX_SIZE+19.25-65,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS(null,"viewBox","0 0 800 800"),s.setAttributeNS(null,"width","800"),s.setAttributeNS(null,"height","800"),s.classList.add("selection"),s.style.top=`${i}px`,s.style.left=`${a}px`;const l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttributeNS(null,"d",e),l.setAttributeNS(null,"fill","#aeff01"),l.setAttributeNS(null,"stroke","#000"),l.setAttributeNS(null,"stroke-width","2"),s.appendChild(l),s},o.createPieceSizeImageOnBoardByPathAndXY=a,o.createPieceSizeImageOnBoardByPath=s,o.createCancelButton=function(){return a(1+9*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.PIECE_SIZE),1+7.5*n.BOX_SIZE,`piece_img/${(0,i.getPieceFont)()}/upright/bmun`,"piece_image_on_board")},o.createPieceSizeImageOnBoardByPath_Shifted=l,o.createPieceSizeSelectionButtonOnBoard_Shifted=function(e){const o=l(e,"selection2","selection");return o.style.cursor="pointer",o.style.zIndex="200",o},o.createGuideImageAt=function(e,o){const[t,r]=e,i=document.createElement("img");return i.setAttribute("draggable","false"),i.classList.add("guide"),i.style.top=1+t*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.MAX_PIECE_SIZE)/2+"px",i.style.left=1+r*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.MAX_PIECE_SIZE)/2+"px",i.src=`image/${o}.png`,i.width=n.MAX_PIECE_SIZE,i.height=n.MAX_PIECE_SIZE,i.style.cursor="守"===o?"not-allowed":"pointer",i.style.opacity="0.3",i},o.createCiurl=function(e,o){const t=document.createElement("img");return t.setAttribute("draggable","false"),t.src=`image/ciurl_${e}.png`,t.width=150,t.height=15,t.classList.add("ciurl"),t.style.left=`${o.left}px`,t.style.top=`${o.top}px`,t.style.zIndex="300",t.style.transform=`rotate(${o.rotateDeg}deg)`,t.style.position="absolute",t},o.createPieceImgToBePlacedOnHop1zuo1=function(e){const o=1+(n.MAX_PIECE_SIZE-n.PIECE_SIZE)/2;return a(e.is_upward?140-n.PIECE_SIZE-o:o,(0,n.hop1_zuo1_left_position)({ind:e.ind,list_length:e.list_length}),e.path,"piece_image_on_hop1zuo1")},o.createPieceImgToBePlacedOnBoard=function(e,o){return s(e,(0,r.toPath_)(o),"piece_image_on_board")},o.createImageButton=function(e,o,t){const r=document.createElement("input");return r.setAttribute("type","image"),r.src=`image/${e}.png`,r.height=200,r.style.backgroundColor="#e0e0e0",r.style.position="absolute",r.style.left="660px",r.style.top=`${o}px`,r.style.border="1px solid #aaaaaa",t&&(r.title=t),r};const r=t(592),n=t(2443),i=t(4316);function a(e,o,t,r){const i=document.createElement("img");return i.setAttribute("draggable","false"),i.classList.add(r),i.style.top=`${e}px`,i.style.left=`${o}px`,i.src=`image/${t}.png`,i.width=n.PIECE_SIZE,i.height=n.PIECE_SIZE,i}function s(e,o,t){const{top:r,left:i}=(0,n.coordToPieceXY)(e);return a(r,i,o,t)}function l(e,o,t){const{top:r,left:i}=(0,n.coordToPieceXY_Shifted)(e);return a(r,i,o,t)}},2421(e,o){"use strict";function t(e){return"boolean"==typeof e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntBoolean=o.isBoolean=void 0,o.isBoolean=t,o.isntBoolean=function(e){return!t(e)}},2443(e,o){"use strict";function t(e){return e.list_length<=9?e.ind:8*e.ind/(e.list_length-1)}Object.defineProperty(o,"__esModule",{value:!0}),o.PIECE_SIZE=o.MAX_PIECE_SIZE=o.BOX_SIZE=void 0,o.adjust_ind_for_hop1zuo1=t,o.coordToPieceXY=function(e){const[t,r]=e;return{top:1+t*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2,left:1+r*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2}},o.coordToPieceXY_Shifted=function(e){const[t,r]=e;return{top:1+t*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE),left:1+r*o.BOX_SIZE}},o.hop1_zuo1_left_position=function(e){return 1+t(e)*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2},o.indToHo1Zuo1OfDownward=function(e){return{top:-135,left:1+e*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2}},o.getDenoteSeasonNodeTopLeft=function(e){return{top:360+51*(3-e),left:3}},o.getDenoteScoreNodeTopLeft=function(e){return{top:447+21.83333333333333*(20-e),left:65}},o.getDenoteRateNodeTopLeft=function(e){return{top:873-48.333333333333336*(e-1),left:4}},o.BOX_SIZE=70,o.MAX_PIECE_SIZE=o.BOX_SIZE-1,o.PIECE_SIZE=60},2552(e,o,t){var r=t(1873),n=t(659),i=t(9350),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?n(e):i(e)}},2664(e,o){"use strict";function t(e){return Array.isArray(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.isntEmptyArray=o.isEmptyArray=o.isntArray=o.isArray=void 0,o.isArray=t,o.isntArray=function(e){return!t(e)},o.isEmptyArray=function(e){return 0===e.length},o.isntEmptyArray=function(e){return 0!==e.length}},2918(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.get_valid_opponent_moves=o.not_from_hand_candidates_with_kut2tam2=o.not_from_hand_candidates=o.not_from_hand_candidates_=o.from_hand_candidates=o.empty_squares=o.get_opponent_pieces_rotated=o.isWater=o.isWaterAbs=o.fromAbsoluteCoord_=o.toAbsoluteCoord_=void 0;const r=t(3218),n=t(7042),i=t(7063);function a([e,o],t){return[["A","E","I","U","O","Y","AI","AU","IA"][t?e:8-e],["K","L","N","T","Z","X","C","M","P"][t?o:8-o]]}function s([e,o]){return 4===e&&2===o||4===e&&3===o||4===e&&4===o||4===e&&5===o||4===e&&6===o||2===e&&4===o||3===e&&4===o||5===e&&4===o||6===e&&4===o}o.toAbsoluteCoord_=a,o.fromAbsoluteCoord_=function([e,o],t){let r,n;if("A"===e)r=0;else if("E"===e)r=1;else if("I"===e)r=2;else if("U"===e)r=3;else if("O"===e)r=4;else if("Y"===e)r=5;else if("AI"===e)r=6;else if("AU"===e)r=7;else{if("IA"!==e)throw new Error("does not happen");r=8}if("K"===o)n=0;else if("L"===o)n=1;else if("N"===o)n=2;else if("T"===o)n=3;else if("Z"===o)n=4;else if("X"===o)n=5;else if("C"===o)n=6;else if("M"===o)n=7;else{if("P"!==o)throw new Error("does not happen");n=8}return t?[r,n]:[8-r,8-n]},o.isWaterAbs=function([e,o]){return"O"===e&&"N"===o||"O"===e&&"T"===o||"O"===e&&"Z"===o||"O"===e&&"X"===o||"O"===e&&"C"===o||"I"===e&&"Z"===o||"U"===e&&"Z"===o||"Y"===e&&"Z"===o||"AI"===e&&"Z"===o},o.isWater=s;const l=[0,1,2,3,4,5,6,7,8];o.get_opponent_pieces_rotated=e=>l.flatMap((o=>l.flatMap((t=>{const n=[o,t],i=e.f.currentBoard[o][t];return null===i?[]:"Tam2"===i?[{rotated_piece:i,rotated_coord:(0,r.rotateCoord)(n)}]:i.side===r.Side.Downward?[{rotated_piece:{prof:i.prof,color:i.color,side:r.Side.Upward},rotated_coord:(0,r.rotateCoord)(n)}]:[]})))),o.empty_squares=e=>l.flatMap((o=>l.flatMap((t=>{const r=[o,t];return null==e.f.currentBoard[o][t]?[r]:[]}))));const c=(e,o)=>(0,i.eightNeighborhood)(o).filter((([o,t])=>null==e[o][t]));o.from_hand_candidates=e=>e.f.hop1zuo1OfDownward.flatMap((t=>(0,o.empty_squares)(e).flatMap((o=>[{type:"NonTamMove",data:{type:"FromHand",color:t.color,prof:t.prof,dest:a(o,e.IA_is_down)}}])))),o.not_from_hand_candidates_=(e,t)=>(0,o.get_opponent_pieces_rotated)(t).flatMap((({rotated_piece:o,rotated_coord:l})=>{const{finite:u,infinite:d}=(0,i.calculateMovablePositions)(l,o,(0,r.rotateBoard)(t.f.currentBoard),t.tam_itself_is_tam_hue),_=[...u.map(r.rotateCoord),...d.map(r.rotateCoord)],f=(0,r.rotateCoord)(l);return _.flatMap((u=>{function d(e,o,t){return s(e)&&!s(t)&&o!==n.Profession.Nuak1}const _=t.f.currentBoard[u[0]][u[1]],p=e=>{const o=u,n=(0,r.rotateBoard)(t.f.currentBoard);n[l[0]][l[1]]=null;const{finite:s,infinite:c}=(0,i.calculateMovablePositions)((0,r.rotateCoord)(o),e,n,t.tam_itself_is_tam_hue),_=s.map(r.rotateCoord),p=c.map(r.rotateCoord);return[..._.flatMap((s=>(0,i.canGetOccupiedBy)(r.Side.Downward,s,{color:e.color,prof:e.prof,side:r.Side.Downward},(0,r.rotateBoard)(n),t.tam_itself_is_tam_hue)?[{type:"NonTamMove",data:{type:"SrcStepDstFinite",src:a(f,t.IA_is_down),step:a(o,t.IA_is_down),dest:a(s,t.IA_is_down),is_water_entry_ciurl:d(s,e.prof,f)}}]:[])),...p.flatMap((s=>(0,i.canGetOccupiedBy)(r.Side.Downward,s,{color:e.color,prof:e.prof,side:r.Side.Downward},(0,r.rotateBoard)(n),t.tam_itself_is_tam_hue)?[{type:"InfAfterStep",src:a(f,t.IA_is_down),step:a(o,t.IA_is_down),plannedDirection:a(s,t.IA_is_down),stepping_ciurl:null,finalResult:null}]:[]))]};if("Tam2"===o){const e=(0,r.rotateBoard)(t.f.currentBoard);if(e[l[0]][l[1]]=null,null===_){const o=u;return(0,i.eightNeighborhood)(o).flatMap((n=>{if(null==t.f.currentBoard[n[0]][n[1]]||(0,r.coordEq)(n,f))return[{type:"TamMove",stepStyle:"NoStep",secondDest:a(n,t.IA_is_down),firstDest:a(o,t.IA_is_down),src:a(f,t.IA_is_down)}];{const i=n;return c((0,r.rotateBoard)(e),i).flatMap((e=>[{type:"TamMove",stepStyle:"StepsDuringLatter",firstDest:a(o,t.IA_is_down),secondDest:a(e,t.IA_is_down),src:a(f,t.IA_is_down),step:a(i,t.IA_is_down)}]))}}))}{const o=u;return c((0,r.rotateBoard)(e),o).flatMap((n=>c((0,r.rotateBoard)(e),n).flatMap((e=>[{type:"TamMove",stepStyle:"StepsDuringFormer",firstDest:a(n,t.IA_is_down),secondDest:a(e,t.IA_is_down),src:a(f,t.IA_is_down),step:a(o,t.IA_is_down)}]))))}}return null===_?[{type:"NonTamMove",data:{type:"SrcDst",src:a(f,t.IA_is_down),dest:a(u,t.IA_is_down),is_water_entry_ciurl:d(u,o.prof,f)}}]:"Tam2"===_?e.allow_kut2tam2?p(o):[]:_.side===r.Side.Upward&&(0,i.canGetOccupiedBy)(r.Side.Downward,u,{color:o.color,prof:o.prof,side:r.Side.Downward},t.f.currentBoard,t.tam_itself_is_tam_hue)?[{type:"NonTamMove",data:{type:"SrcDst",src:a(f,t.IA_is_down),dest:a(u,t.IA_is_down),is_water_entry_ciurl:d(u,o.prof,f)}},...p(o)]:p(o)}))})),o.not_from_hand_candidates=e=>(0,o.not_from_hand_candidates_)({allow_kut2tam2:!1},e),o.not_from_hand_candidates_with_kut2tam2=e=>(0,o.not_from_hand_candidates_)({allow_kut2tam2:!0},e),o.get_valid_opponent_moves=function(e){return[...(0,o.from_hand_candidates)(e),...(0,o.not_from_hand_candidates_)({allow_kut2tam2:!1},e)]}},3075(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.drawFinalScoreDisplay=function(e){const o=e=>s((0,a.toDigitsLinzklar)(e.score),{left:530-60*e.column_index,top:23.5*(2-(0,a.toDigitsLinzklar)(e.score).length)+239,width:50}),t=[].concat(...e),r=20+t.reduce(((e,o)=>e+o),0),n=document.getElementById("final_score_display");n.classList.remove("nocover"),(0,i.removeAllChildren)(n),n.append(...Array.from({length:e.length},((o,t)=>function(e){const o=document.createElement("img");return o.src=`image/season/${["春","夏","秋","冬"][e.season]}.png`,o.style.position="absolute",o.style.left=`${e.left}px`,o.style.top="15px",o.width=50,o}({left:530-60*[].concat(...e.slice(0,t)).length,season:t})))),n.append(...t.flatMap(((e,t)=>o({score:e,column_index:t})))),n.append(...o({score:20,column_index:-1})),n.append(function(){const e=document.createElement("img");return e.src="image/始.png",e.style.position="absolute",e.style.left="590px",e.style.top="15px",e.width=50,e}()),n.append(...l(r)),document.getElementById("to_entrance").classList.remove("nocover")},o.drawScoreDisplay=function(e){const o=e.sort(((e,o)=>{const t=["同色無抗行処","無抗行処","同色筆兵無傾","筆兵無傾","同色地心","地心","同色馬弓兵","馬弓兵","同色行行","行行","王","同色獣","獣","同色戦集","戦集","同色助友","助友","同色闇戦之集","闇戦之集","撃皇","皇再来"];return t.indexOf(e)-t.indexOf(o)}));if(o.length>11)throw new Error("too many hands");const[t,c]=[[550,60],[550,60],[550,60],[550,60],[550,60],[550,60],[550,60],[550,60],[550,60],[575,57],[585,53],[595,49]][o.length],u=document.getElementById("score_display");u.classList.remove("nocover"),(0,i.removeAllChildren)(u),document.getElementById("yaku_all").style.left="790px";const d=o.map((e=>r.hand_to_score[e])).reduce(((e,o)=>e+o),0);u.append(...o.flatMap(((e,o)=>{const i=t-c*o,l=s((0,a.toDigitsLinzklar)(r.hand_to_score[e]),{left:i,top:295,width:50});return"同色"===e.slice(0,2)?(l.push((0,n.createHandImage)(e.slice(2),{left:i,top_padding:15})),l.push((0,n.createBapPokImage)({left:i,top_padding:15}))):l.push((0,n.createHandImage)(e,{left:i,top_padding:15})),l}))),u.append(...l(d))};const r=t(9411),n=t(2167),i=t(1848),a=t(9784);function s(e,o){return e.map(((e,t)=>{const r=document.createElement("img");return r.src=`image/digit/${e}.png`,r.style.position="absolute",r.style.left=`${o.left}px`,r.style.top=`${.94*o.width*t+o.top}px`,r.width=o.width,r}))}function l(e){const o=(0,a.toDigitsLinzklar)(e);return s(o,{left:20,top:234-70*o.length/2,width:70})}},3218(e,o){"use strict";var t;Object.defineProperty(o,"__esModule",{value:!0}),o.rotateBoard=o.rotateCoord=o.coordEq=o.toUpOrDown=o.fromUpOrDown=o.Side=void 0,function(e){e[e.Upward=0]="Upward",e[e.Downward=1]="Downward"}(t=o.Side||(o.Side={})),o.fromUpOrDown=function(e){return{color:e.color,prof:e.prof,side:e.side}},o.toUpOrDown=function(e){return e.side,t.Downward,{color:e.color,prof:e.prof,side:e.side}},o.coordEq=function(e,o){return e[0]===o[0]&&e[1]===o[1]},o.rotateCoord=function(e){return[8-e[0],8-e[1]]},o.rotateBoard=function(e){const o=[[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"]];for(let r=0;r<9;r++)for(let n=0;n<9;n++)o[r][n]=null===(t=e[8-r][8-n])||"Tam2"===t?t:{prof:t.prof,color:t.color,side:1-t.side};var t;return o}},3262(e,o){"use strict";function t(e){return!e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntFalsy=o.isFalsy=void 0,o.isFalsy=t,o.isntFalsy=function(e){return!t(e)}},3296(e,o){"use strict";function t(e){return"string"==typeof e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntString=o.isString=void 0,o.isString=t,o.isntString=function(e){return!t(e)}},3323(e,o){"use strict";function t(e){return e instanceof Error}Object.defineProperty(o,"__esModule",{value:!0}),o.isntError=o.isError=void 0,o.isError=t,o.isntError=function(e){return!t(e)}},3822(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isntNullish=o.isNullish=void 0;const r=t(1168),n=t(8065);function i(e){return(0,r.isNull)(e)||(0,n.isUndefined)(e)}o.isNullish=i,o.isntNullish=function(e){return!i(e)}},4068(e,o,t){"use strict";var r,n=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(o,t);n&&!("get"in n?!o.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,n)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var o=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[o.length]=t);return o},r(e)},function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t=r(e),a=0;a<t.length;a++)"default"!==t[a]&&n(o,e,t[a]);return i(o,e),o});Object.defineProperty(o,"__esModule",{value:!0}),o.LORK_LIAR=o.LORK_LIAR_ENABLED=o.KRUT_CRUOP=void 0,o.stopMusicLoop=function(){_.loop=!1};const s=t(5746),l=t(5562),c=a(t(8442)),u=t(5885);document.getElementById("coord_annotation").src=`image/IA_is_down=${l.GAME_STATE.IA_is_down}_x-faikleone=${"x-faikleone"===sessionStorage.lang}.svg`,console.log("drawField #",0),(0,s.drawField)({focus:null}),"x-faikleone"===sessionStorage.lang?(document.getElementById("kiar_ark").classList.add("always_linmarn_bitmap"),document.getElementById("opponent_message_linzklar").classList.add("always_geometric_linzklar")):(document.getElementById("kiar_ark").classList.add("use_linmarn_bitmap_unless_hovered"),document.getElementById("opponent_message_linzklar").classList.add("use_geometric_linzklar_unless_hovered")),sessionStorage.kiar_ark?(c.resurrect(JSON.parse(sessionStorage.kiar_ark)),c.display_kiar_ark()):c.push_header_elem_and_display({type:"header",dat:`{始時:${(new Date).toISOString()}}`});let d=!1;document.getElementById("coord_toggle_button").addEventListener("click",(()=>{d=!d,console.log("COORD_TOGGLE now set to",d),document.getElementById("coord_annotation").style.visibility=d?"visible":"hidden",document.getElementById("coord_toggle_button").src=d?"image/toggle/coord_toggle_active.png":"image/toggle/coord_toggle_inactive.png"})),o.KRUT_CRUOP=!0,document.getElementById("krut_cruop_button").addEventListener("click",(()=>{o.KRUT_CRUOP=!o.KRUT_CRUOP,console.log("KRUT_CRUOP now set to",o.KRUT_CRUOP),document.getElementById("krut_cruop_button").src=o.KRUT_CRUOP?"image/toggle/kut2_cuop2_active.png":"image/toggle/kut2_cuop2_inactive.png"}));const _=new Audio(Math.random()<.5?"sound/cetkaik_ad_loop.mp3":"sound/cetkaik_leti_duxe_.ogg");_.loop=!0;let f=!1;function p(){o.LORK_LIAR_ENABLED=!o.LORK_LIAR_ENABLED,!f&&o.LORK_LIAR_ENABLED&&(_.play(),f=!0),document.getElementById("lork_liar_button").src=o.LORK_LIAR_ENABLED?"image/toggle/lok1_lia1_active.png":"image/toggle/lok1_lia1_inactive.png",document.getElementById("volume_slidebar").disabled=!o.LORK_LIAR_ENABLED,_.volume=o.LORK_LIAR_ENABLED?o.LORK_LIAR/100:0}o.LORK_LIAR_ENABLED=!1,o.LORK_LIAR=Number(document.getElementById("volume_slidebar").value),_.volume=o.LORK_LIAR_ENABLED?o.LORK_LIAR/100:0,document.getElementById("lork_liar_button").addEventListener("click",p),document.getElementById("volume_slidebar").addEventListener("input",(()=>{o.LORK_LIAR=Number(document.getElementById("volume_slidebar").value),_.volume=o.LORK_LIAR_ENABLED?o.LORK_LIAR/100:0})),sessionStorage.getItem("game_state_backup")?(document.getElementById("kait_kaik_button").src="image/ty_zau.png",document.getElementById("kait_kaik_button").addEventListener("click",(async()=>{(0,u.apply_membrane_state_to_dom)(),l.GAME_STATE.is_my_turn=!!l.GAME_STATE.is_my_turn,document.getElementById("kait_kaik").classList.add("nocover"),o.LORK_LIAR_ENABLED||p()}))):document.getElementById("kait_kaik_button").addEventListener("click",(async()=>{document.getElementById("kait_kaik").classList.add("nocover");const e=JSON.parse(sessionStorage.is_first_move_my_move);o.LORK_LIAR_ENABLED||p(),await(0,s.animateSeasonInitiation)(e)})),"cpu"===sessionStorage.vs?document.getElementById("opponent_icon").innerHTML='<img src="image/nystiper2.png">':"someone"===sessionStorage.vs?document.getElementById("opponent_icon").innerHTML='<img src="image/larta2.png">':location.href="entrance.html"},4316(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getPieceFont=function(){return t},o.setPieceFont=r;let t="官字";function r(e){console.log("changing the piece font",t,"into",e),document.getElementById("denote_season").src=`image/piece_img/${e}/upright/rtam.png`;for(const o of["contains_pieces_on_upward","contains_pieces_on_downward","contains_pieces_on_board","contains_phantom"]){const r=document.getElementById(o);for(const o of r.childNodes)o instanceof HTMLImageElement&&(o.src=decodeURI(o.src).replace(t,e))}t=e}const n=["官字","略字","やる気なし"];for(const e of n)document.getElementById(`radio_${e}`).addEventListener("click",(()=>r(e)))},4335(e){e.exports=function(e,o){return function(t){return e(o(t))}}},4761(e,o){"use strict";function t(e){return"function"==typeof e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntFunction=o.isFunction=void 0,o.isFunction=t,o.isntFunction=function(e){return!t(e)}},4840(e,o,t){var r="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g;e.exports=r},5285(e,o){"use strict";function t(e){return"symbol"==typeof e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntSymbol=o.isSymbol=void 0,o.isSymbol=t,o.isntSymbol=function(e){return!t(e)}},5506(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0})},5562(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.GAME_STATE=o.initial_board_with_IA_down=void 0,o.toAbsoluteCoord=function(e){return(0,a.toAbsoluteCoord_)(e,o.GAME_STATE.IA_is_down)},o.fromAbsoluteCoord=function(e){return(0,a.fromAbsoluteCoord_)(e,o.GAME_STATE.IA_is_down)},o.back_up_gamestate=function(){const e={IA_is_down:o.GAME_STATE.IA_is_down,my_score:o.GAME_STATE.my_score,season:o.GAME_STATE.season,scores_of_each_season:o.GAME_STATE.scores_of_each_season,log2_rate:o.GAME_STATE.log2_rate,last_move_focus:o.GAME_STATE.last_move_focus,f:o.GAME_STATE.f,backupDuringStepping:o.GAME_STATE.backupDuringStepping};sessionStorage.game_state_backup=JSON.stringify(e)};const r=t(8322),n=t(7042),i=t(627),a=t(8322),s=t(5885);o.initial_board_with_IA_down=[[{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Io,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Downward}],[{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Downward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Downward}],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Nuak1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward}],[null,null,null,null,null,null,null,null,null],[null,null,null,null,"Tam2",null,null,null,null],[null,null,null,null,null,null,null,null,null],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Nuak1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward}],[{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Upward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Upward}],[{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Io,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Upward}]];const l=e=>{let o=!0,t=e.my_score;const r=e.scores_of_each_season;let n=e.season;const a=e.log2_rate;return{last_move_focus:e.last_move_focus,f:e.f,IA_is_down:e.IA_is_down,tam_itself_is_tam_hue:!0,opponent_has_just_moved_tam:!1,set is_my_turn(e){o=!!e,o?(document.getElementById("my_icon").style.opacity="1",document.getElementById("larta_opponent").style.opacity="0.3",document.getElementById("opponent_message").textContent="",document.getElementById("opponent_message_linzklar").textContent="",(0,s.remove_cover)("protective_cover_over_field_while_waiting_for_opponent")):(document.getElementById("my_icon").style.opacity="0.3",document.getElementById("larta_opponent").style.opacity="1",(0,s.add_cover)("protective_cover_over_field_while_waiting_for_opponent"),window.setTimeout(i.sendMainPollAndDoEverythingThatFollows,500*.8093))},get is_my_turn(){return o},backupDuringStepping:e.backupDuringStepping,set my_score(e){r[n].push(e-t),t=e},get my_score(){return t},get season(){return n},set season(e){n=e},get scores_of_each_season(){return[r[0].concat([]),r[1].concat([]),r[2].concat([]),r[3].concat([])]},set scores_of_each_season(e){throw new Error("Cannot set scores_of_each_season. Please set my_score to reflect the change in the score.")},log2_rate:a}};var c;o.GAME_STATE=sessionStorage.getItem("game_state_backup")?l(JSON.parse(sessionStorage.game_state_backup)):l({IA_is_down:(c={IA_is_down:(()=>{try{return JSON.parse(sessionStorage.is_IA_down_for_me)}catch{location.href="entrance.html"}})()}).IA_is_down,my_score:20,season:0,scores_of_each_season:[[],[],[],[]],log2_rate:0,last_move_focus:null,f:{currentBoard:c.IA_is_down?(0,r.rotateBoard)((0,r.rotateBoard)(o.initial_board_with_IA_down)):(0,r.rotateBoard)(o.initial_board_with_IA_down),hop1zuo1OfDownward:[],hop1zuo1OfUpward:[]},backupDuringStepping:null})},5598(e,o){"use strict";function t(e){return"bigint"==typeof e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntBigInt=o.isBigInt=void 0,o.isBigInt=t,o.isntBigInt=function(e){return!t(e)}},5746(e,o,t){"use strict";var r,n=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(o,t);n&&!("get"in n?!o.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,n)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var o=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[o.length]=t);return o},r(e)},function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t=r(e),a=0;a<t.length;a++)"default"!==t[a]&&n(o,e,t[a]);return i(o,e),o});Object.defineProperty(o,"__esModule",{value:!0}),o.drawMak2Io1=v,o.drawField=S,o.animatePunishStepTamAndCheckPerzej=async function(e){document.getElementById("score_display").classList.add("nocover"),document.getElementById("yaku_all").style.left="750px";const o=document.getElementById("denote_score"),t=s.GAME_STATE.my_score;return s.GAME_STATE.my_score+=(e===c.Side.Upward?-5:5)*Math.pow(2,s.GAME_STATE.log2_rate),(0,s.back_up_gamestate)(),await new Promise((e=>setTimeout(e,161.86))),await(0,E.animateNode)(o,1e3*.8093,{to:(0,u.getDenoteScoreNodeTopLeft)(s.GAME_STATE.my_score),from:(0,u.getDenoteScoreNodeTopLeft)(t)}),s.GAME_STATE.my_score>=40?(b("you win!",!0),void(0,A.add_cover)("protective_cover_over_field_while_waiting_for_opponent")):s.GAME_STATE.my_score<=0?(b("you lose...",!0),void(0,A.add_cover)("protective_cover_over_field_while_waiting_for_opponent")):(await new Promise((e=>setTimeout(e,242.79))),v(),await new Promise((e=>setTimeout(e,242.79))),(0,A.remove_cover)("protective_cover_over_field"),(0,A.remove_cover)("protective_tam_cover_over_field"),void(0,A.remove_cover)("protective_cover_over_field_while_asyncawait"))},o.calculateHandsAndScore=function(e){const o=e.map((e=>{return o=e.color,t=e.prof,[["赤船","赤兵","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","赤王"],["黒船","黒兵","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","黒王"]][o][t];var o,t})),t=(0,p.calculate_hands_and_score_from_pieces)(o);if(!0===t.error)throw new Error(`should not happen: too many of ${t.too_many.join(",")}`);return{hands:t.hands,score:t.score}},o.sendStuffTo=async function(e,o,t,r){(0,A.add_cover)("protective_cover_over_field_while_asyncawait"),console.log(`Sending ${o}:`,JSON.stringify(t));const n=`${_.API_ORIGIN}/${e}/`,i={message:t},a=await fetch(n,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.session_token}`}}).then((e=>((0,A.remove_cover)("protective_cover_over_field_while_asyncawait"),e.json()))).then(r).catch((e=>{(0,A.remove_cover)("protective_cover_over_field_while_asyncawait"),console.error("Error:",e)}));if(console.log(a),(0,A.remove_cover)("protective_cover_over_field_while_asyncawait"),!a)throw alert("network error!"),(0,A.remove_cover)("protective_cover_over_field_while_asyncawait"),new Error("network error!");return a},o.endSeason=function(e,o){document.getElementById("score_display").classList.add("nocover"),document.getElementById("yaku_all").style.left="750px";const t=document.getElementById("denote_season"),r=document.getElementById("denote_score"),n=s.GAME_STATE.my_score,i=s.GAME_STATE.season;s.GAME_STATE.my_score+=e*Math.pow(2,s.GAME_STATE.log2_rate),(0,s.back_up_gamestate)();const a={0:1,1:2,2:3,3:null}[i];null!=a?(s.GAME_STATE.season=a,(0,s.back_up_gamestate)(),setTimeout((async()=>{await(0,E.animateNode)(r,1e3*.8093,{to:(0,u.getDenoteScoreNodeTopLeft)(s.GAME_STATE.my_score),from:(0,u.getDenoteScoreNodeTopLeft)(n)}),s.GAME_STATE.my_score>=40?b("you win!",!1):s.GAME_STATE.my_score<=0?b("you lose...",!1):(await(0,E.animateNode)(t,566.51,{to:(0,u.getDenoteSeasonNodeTopLeft)(s.GAME_STATE.season),from:(0,u.getDenoteSeasonNodeTopLeft)(i)}),await new Promise((e=>setTimeout(e,242.79))),v(),"x-faikleone"!==sessionStorage.lang&&alert(d.DICTIONARY.ja.newSeason[s.GAME_STATE.season]),await new Promise((e=>setTimeout(e,242.79))),await new Promise(((e,o)=>{const t=document.getElementById("season_transition_message_or_water_entry_failure_message");t.onload=()=>e(t),t.onerror=e=>o(e),t.src=`image/season_transition_${i}_to_${a}.png`})),(0,A.add_cover)("protective_cover_over_field"),(0,A.add_cover)("protective_tam_cover_over_field"),document.getElementById("season_transition_message_or_water_entry_failure_message_container").classList.remove("nocover"),await new Promise((e=>setTimeout(e,4e3*.8093))),s.GAME_STATE.f={currentBoard:s.GAME_STATE.IA_is_down?(0,c.rotateBoard)((0,c.rotateBoard)(s.initial_board_with_IA_down)):(0,c.rotateBoard)(s.initial_board_with_IA_down),hop1zuo1OfDownward:[],hop1zuo1OfUpward:[]},(0,s.back_up_gamestate)(),s.GAME_STATE.log2_rate=0,(0,s.back_up_gamestate)(),v(),(0,l.allowMainPolling)(),s.GAME_STATE.last_move_focus=null,(0,s.back_up_gamestate)(),console.log("drawField #",11),S({focus:null}),await P(o),(0,A.remove_cover)("protective_cover_over_field"),(0,A.remove_cover)("protective_tam_cover_over_field"),(0,A.remove_cover)("protective_cover_over_field_while_asyncawait"),document.getElementById("season_transition_message_or_water_entry_failure_message_container").classList.add("nocover"))}),161.86)):setTimeout((async()=>(await(0,E.animateNode)(r,1e3*.8093,{to:(0,u.getDenoteScoreNodeTopLeft)(s.GAME_STATE.my_score),from:(0,u.getDenoteScoreNodeTopLeft)(n)}),"x-faikleone"!==sessionStorage.lang&&alert(d.DICTIONARY.ja.gameEnd),s.GAME_STATE.my_score>20?void b("you win!",!1):s.GAME_STATE.my_score<20?void b("you lose...",!1):void b("draw",!1))),161.86)},o.animateSeasonInitiation=P,o.increaseRateAndAnimate=function(e){document.getElementById("score_display").classList.add("nocover"),document.getElementById("yaku_all").style.left="750px";const o=s.GAME_STATE.log2_rate;v(),s.GAME_STATE.log2_rate={0:1,1:2,2:3,3:4,4:5,5:6,6:6}[o],(0,s.back_up_gamestate)();const t=document.getElementById("denote_rate");setTimeout((async()=>{t.style.display="block",await new Promise((e=>setTimeout(e,161.86))),await(0,E.animateNode)(t,1e3*.8093,{to:(0,u.getDenoteRateNodeTopLeft)(s.GAME_STATE.log2_rate),from:(0,u.getDenoteRateNodeTopLeft)(o)}),await new Promise((e=>setTimeout(e,500*.8093))),v(),e?((0,l.allowMainPolling)(),setTimeout(l.sendMainPollAndDoEverythingThatFollows,500*.8093)):(s.GAME_STATE.is_my_turn=!0,(0,s.back_up_gamestate)()),(0,A.remove_cover)("protective_cover_over_field_while_asyncawait")}),161.86)};const s=t(5562),l=t(627),c=t(8322),u=t(2443),d=t(7630),_=t(9451),f=t(3075),p=t(9411),m=a(t(8442)),E=t(8549),w=t(2167),g=t(7927),y=t(592),T=t(1848),A=t(5885),h=t(4068);function v(){const e=document.getElementById("denote_season");e.style.top=`${(0,u.getDenoteSeasonNodeTopLeft)(s.GAME_STATE.season).top}px`,e.style.transition="",e.style.transform="";const o=document.getElementById("denote_score");o.style.top=`${(0,u.getDenoteScoreNodeTopLeft)(s.GAME_STATE.my_score).top}px`,o.style.transition="",o.style.transform="";const t=document.getElementById("denote_rate");0===s.GAME_STATE.log2_rate?t.style.display="none":t.style.display="block",t.style.top=`${(0,u.getDenoteRateNodeTopLeft)(s.GAME_STATE.log2_rate).top}px`,t.style.transition="",t.style.transform=""}function S(e){console.log("focusing:",e.focus?(0,s.toAbsoluteCoord)(e.focus):null);{const o=s.GAME_STATE.f.currentBoard,t=document.getElementById("contains_pieces_on_board");(0,T.removeAllChildren)(t);for(let r=0;r<o.length;r++)for(let n=0;n<o[r].length;n++){const i=o[r][n];if(null==i)continue;const a=[r,n],l=(0,w.createPieceImgToBePlacedOnBoard)(a,i);if(l.id=`field_piece_${r}_${n}`,e.focus&&a[0]===e.focus[0]&&a[1]===e.focus[1]&&(l.style.border="8px solid #ff6",l.style.margin="-8px"),"Tam2"===i)s.GAME_STATE.opponent_has_just_moved_tam||(l.style.cursor="pointer",l.addEventListener("click",(function(){(0,g.selectOwnPieceOnBoard)(a,i)})));else if(i.side===c.Side.Upward){const e={prof:i.prof,side:c.Side.Upward,color:i.color};l.style.cursor="pointer",l.addEventListener("click",(function(){(0,g.selectOwnPieceOnBoard)(a,e)}))}t.appendChild(l)}}{const e=s.GAME_STATE.f.hop1zuo1OfUpward,o=document.getElementById("contains_pieces_on_upward");(0,T.removeAllChildren)(o);for(let t=0;t<e.length;t++){const r=e[t],n=(0,w.createPieceImgToBePlacedOnHop1zuo1)({ind:t,path:(0,y.toPath)(r),list_length:e.length,is_upward:!0});n.style.cursor="pointer",n.addEventListener("click",(function(){(0,g.selectOwnPieceOnHop1zuo1)(t,r,e.length)})),o.appendChild(n)}}{const e=s.GAME_STATE.f.hop1zuo1OfDownward,o=document.getElementById("contains_pieces_on_downward");(0,T.removeAllChildren)(o);for(let t=0;t<e.length;t++){const r=e[t],n=(0,w.createPieceImgToBePlacedOnHop1zuo1)({ind:t,path:(0,y.toPath)(r),list_length:e.length,is_upward:!1});n.id=`hop1zuo1OfDownward_${t}`,o.appendChild(n)}}}function b(e,o){(0,f.drawFinalScoreDisplay)(function(e,o){const t=e=>[e.slice(0,-1).reduce(((e,o)=>e+o),0),e[e.length-1]],r=e?e=>[e.reduce(((e,o)=>e+o),0)]:t;if(0===o[0].length)throw new Error("why did the game end without any movement of points?");return 0===o[1].length?[r(o[0])]:0===o[2].length?[t(o[0]),r(o[1])]:0===o[3].length?[t(o[0]),t(o[1]),r(o[2])]:[t(o[0]),t(o[1]),t(o[2]),r(o[3])]}(o,s.GAME_STATE.scores_of_each_season)),document.getElementById("my_icon").style.opacity="1",document.getElementById("larta_opponent").style.opacity="1","x-faikleone"!==sessionStorage.lang&&(document.getElementById("opponent_message").textContent="you win!"===e?d.DICTIONARY.ja.gameResult.victory:"draw"===e?d.DICTIONARY.ja.gameResult.draw:d.DICTIONARY.ja.gameResult.loss),document.getElementById("opponent_message_linzklar").textContent="you win!"===e?d.GAME_END_LINZKLAR.victory:"draw"===e?d.GAME_END_LINZKLAR.draw:d.GAME_END_LINZKLAR.loss,m.push_body_elem_and_display({type:"tymoktaxot",dat:"星一周"}),m.push_header_elem_and_display({type:"header",dat:`{終時:${(new Date).toISOString()}}`}),(0,h.stopMusicLoop)()}async function P(e){await(0,g.animateProcessDeterminingWhoGoesFirst)(e),await new Promise((e=>setTimeout(e,2427.9))),s.GAME_STATE.is_my_turn=e.result,(0,s.back_up_gamestate)(),m.push_initial_colors_and_display(s.GAME_STATE.is_my_turn===s.GAME_STATE.IA_is_down?"黒":"赤")}},5885(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.apply_membrane_state_to_dom=function(){function e(e){var o,r;t[e]?null===(o=document.getElementById(e))||void 0===o||o.classList.remove("nocover"):null===(r=document.getElementById(e))||void 0===r||r.classList.add("nocover")}e("protective_cover_over_field"),e("protective_tam_cover_over_field"),e("protective_cover_over_field_while_asyncawait"),e("protective_cover_over_field_while_waiting_for_opponent")},o.add_cover=function(e){var o;null===(o=document.getElementById(e))||void 0===o||o.classList.remove("nocover"),t[e]=!0,sessionStorage.membrane_state_backup=JSON.stringify(t)},o.remove_cover=function(e){var o;null===(o=document.getElementById(e))||void 0===o||o.classList.add("nocover"),t[e]=!1,sessionStorage.membrane_state_backup=JSON.stringify(t)};const t=sessionStorage.getItem("membrane_state_backup")?JSON.parse(sessionStorage.membrane_state_backup):{protective_cover_over_field:!1,protective_tam_cover_over_field:!1,protective_cover_over_field_while_asyncawait:!1,protective_cover_over_field_while_waiting_for_opponent:!0}},6418(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.serializeAbsoluteCoord=n,o.serializeCiurlCount=i,o.serializeCiurl=function(e){return i(e.filter((e=>e)).length)},o.serializeColor=a,o.serializeProf=s,o.normalMoveToKiarArk=function(e,o){if("NonTamMove"===e.type){const t=(()=>{if("Tam2"===o.piece_moved)throw new Error("Tam2 was passed to `o.piece_moved` inside `normalMoveToKiarArk` even though `message.type` is `NonTamMove`");return s(o.piece_moved.prof)})();if("FromHand"===e.data.type)return`${a(e.data.color)}${s(e.data.prof)}${n(e.data.dest)}`;if("SrcDst"===e.data.type)return void 0===(null==o?void 0:o.water_ciurl_count)?`${n(e.data.src)}${t}${n(e.data.dest)}無撃裁`:(null==o?void 0:o.water_ciurl_count)<3?`${n(e.data.src)}${t}${n(e.data.dest)}水${i(null==o?void 0:o.water_ciurl_count)}此無`:`${n(e.data.src)}${t}${n(e.data.dest)}水${i(null==o?void 0:o.water_ciurl_count)}`;if("SrcStepDstFinite"===e.data.type)return void 0===(null==o?void 0:o.water_ciurl_count)?`${n(e.data.src)}${t}${n(e.data.step)}${n(e.data.dest)}無撃裁`:(null==o?void 0:o.water_ciurl_count)<3?`${n(e.data.src)}${t}${n(e.data.step)}${n(e.data.dest)}水${i(null==o?void 0:o.water_ciurl_count)}此無`:`${n(e.data.src)}${t}${n(e.data.step)}${n(e.data.dest)}水${i(null==o?void 0:o.water_ciurl_count)}`;throw e.data,new Error("should not reach here")}if("TamMove"===e.type){if("NoStep"===e.stepStyle)return`${n(e.src)}皇[${n(e.firstDest)}]${n(e.secondDest)}`;if("StepsDuringFormer"===e.stepStyle)return`${n(e.src)}皇${n(e.step)}[${n(e.firstDest)}]${n(e.secondDest)}`;if("StepsDuringLatter"===e.stepStyle)return`${n(e.src)}皇[${n(e.firstDest)}]${n(e.step)}${n(e.secondDest)}`;throw e.stepStyle,new Error("should not reach here")}throw new Error("should not reach here")};const r=t(7042);function n(e){return`${e[1]}${e[0]}`}function i(e){return["無","一","二","三","四","五"][e]}function a(e){return e===r.Color.Huok2?"黒":"赤"}function s(e){return["船","兵","弓","車","虎","馬","筆","巫","将","王"][e]}},6667(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isntIterable=o.isIterable=void 0;const r=t(1168),n=t(8065),i=t(4761);function a(e){return(0,r.isntNull)(e)&&(0,n.isntUndefined)(e)&&(0,i.isFunction)(e[Symbol.iterator])}o.isIterable=a,o.isntIterable=function(e){return!a(e)}},6759(e,o){"use strict";var t,r;Object.defineProperty(o,"__esModule",{value:!0}),o.Profession=o.Color=void 0,(r=o.Color||(o.Color={}))[r.Kok1=0]="Kok1",r[r.Huok2=1]="Huok2",(t=o.Profession||(o.Profession={}))[t.Nuak1=0]="Nuak1",t[t.Kauk2=1]="Kauk2",t[t.Gua2=2]="Gua2",t[t.Kaun1=3]="Kaun1",t[t.Dau2=4]="Dau2",t[t.Maun1=5]="Maun1",t[t.Kua2=6]="Kua2",t[t.Tuk2=7]="Tuk2",t[t.Uai1=8]="Uai1",t[t.Io=9]="Io"},7042(e,o,t){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),n=this&&this.__exportStar||function(e,o){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(o,t)||r(o,e,t)};Object.defineProperty(o,"__esModule",{value:!0}),n(t(6759),o),n(t(8003),o),n(t(5506),o)},7063(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.calculateMovablePositions=o.canGetOccupiedByNonTam=o.canGetOccupiedBy=o.isTamHue=o.eightNeighborhood=void 0;const r=t(3218),n=t(7042);function i(e,o){const[t,r]=e;return o.map((([e,o])=>[t+e,r+o])).filter((([e,o])=>0<=e&&e<=8&&0<=o&&o<=8)).map((([e,o])=>[e,o]))}function a(e){const[o,t]=e,r=[];for(let e=-8;e<=8;e++)for(let n=-8;n<=8;n++)o*n-t*e==0&&(o*e+t*n<=0||e*e+n*n>=o*o+t*t||(r[r.length]=[e,n]));return r}function s(e,o,t){return[].concat(...o.map((o=>l(e,o,t))))}function l(e,o,t){return i(e,a(o)).every((([e,o])=>null==t[e][o]))?i(e,[o]):[]}function c(e,o,t){return[].concat(...o.map((o=>function(e,o,t){return i(e,a(o)).filter((([e,o])=>null!=t[e][o])).length<=1?i(e,[o]):[]}(e,o,t))))}function u(e){return i(e,[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]])}function d(e,o,t){return!!((0,r.coordEq)(e,[2,2])||(0,r.coordEq)(e,[2,6])||(0,r.coordEq)(e,[3,3])||(0,r.coordEq)(e,[3,5])||(0,r.coordEq)(e,[4,4])||(0,r.coordEq)(e,[5,3])||(0,r.coordEq)(e,[5,5])||(0,r.coordEq)(e,[6,2])||(0,r.coordEq)(e,[6,6]))||!(!t||"Tam2"!==o[e[0]][e[1]])||u(e).some((([e,t])=>"Tam2"===o[e][t]))}function _(e,o,t,r){const[i,a]=o,s=t[i][a];return"Tam2"!==s&&(null===s||s.side!==e&&!((e,o)=>u(o).filter((([o,i])=>{const a=t[o][i];return null!=a&&"Tam2"!==a&&a.prof===n.Profession.Uai1&&a.side!==e&&d([o,i],t,r)})).length>0)(e,o))}console.assert("[[-4,2],[-2,1]]"===JSON.stringify(a([-6,3]))),console.assert("[[-2,0],[-1,0]]"===JSON.stringify(a([-3,0]))),console.assert("[[0,1],[0,2]]"===JSON.stringify(a([0,3]))),o.eightNeighborhood=u,o.isTamHue=d,o.canGetOccupiedBy=function(e,o,t,r,n){if("Tam2"===t){const[e,t]=o;return null===r[e][t]}return _(e,o,r,n)},o.canGetOccupiedByNonTam=_,o.calculateMovablePositions=function(e,o,t,r){if("Tam2"===o)return{finite:u(e),infinite:[]};if(o.prof===n.Profession.Io)return{finite:u(e),infinite:[]};const _=[[-8,-8],[-7,-7],[-6,-6],[-5,-5],[-4,-4],[-3,-3],[-2,-2],[-1,-1]],f=[[-8,8],[-7,7],[-6,6],[-5,5],[-4,4],[-3,3],[-2,2],[-1,1]],p=[[8,-8],[7,-7],[6,-6],[5,-5],[4,-4],[3,-3],[2,-2],[1,-1]],m=[[8,8],[7,7],[6,6],[5,5],[4,4],[3,3],[2,2],[1,1]],E=[[-1,0],[-2,0],[-3,0],[-4,0],[-5,0],[-6,0],[-7,0],[-8,0]],w=[[1,0],[2,0],[3,0],[4,0],[5,0],[6,0],[7,0],[8,0]],g=[[0,-1],[0,-2],[0,-3],[0,-4],[0,-5],[0,-6],[0,-7],[0,-8]],y=[[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[0,7],[0,8]];if(d(e,t,r))switch(o.prof){case n.Profession.Uai1:return{finite:u(e),infinite:[]};case n.Profession.Kaun1:return{finite:i(e,[[-2,-2],[-2,2],[2,2],[2,-2]]),infinite:[]};case n.Profession.Kauk2:return{finite:[...i(e,[[-1,0],[0,-1],[0,1],[1,0]]),...l(e,[-2,0],t)],infinite:[]};case n.Profession.Nuak1:return{finite:[...i(e,[[0,-1],[0,1]]),...s(e,[[0,-2],[0,2]],t)],infinite:s(e,[...E,...w],t)};case n.Profession.Gua2:case n.Profession.Dau2:return{finite:[],infinite:s(e,[..._,...f,...p,...m],t)};case n.Profession.Maun1:{const o=[[-8,-8],[-7,-7],[-6,-6],[-5,-5],[-4,-4],[-3,-3],[-2,-2],[-8,8],[-7,7],[-6,6],[-5,5],[-4,4],[-3,3],[-2,2],[8,-8],[7,-7],[6,-6],[5,-5],[4,-4],[3,-3],[2,-2],[8,8],[7,7],[6,6],[5,5],[4,4],[3,3],[2,2]];let r=[];for(let n=0;n<o.length;n++){const s=o[n];i(e,a(s).filter((e=>!([-1,1].includes(e[0])&&[-1,1].includes(e[1]))))).every((([e,o])=>null==t[e][o]))&&(r=[...r,...i(e,[s])])}return{finite:[],infinite:r}}case n.Profession.Kua2:return{finite:[],infinite:s(e,[...E,...w,...g,...y],t)};case n.Profession.Tuk2:return{finite:[],infinite:c(e,[...E,...w,...g,...y,..._,...f,...p,...m],t)};default:return o.prof}else switch(o.prof){case n.Profession.Kauk2:return{finite:i(e,[[-1,0]]),infinite:[]};case n.Profession.Kaun1:return{finite:i(e,[[-2,0],[2,0],[0,-2],[0,2]]),infinite:[]};case n.Profession.Dau2:return{finite:i(e,[[-1,-1],[-1,1],[1,-1],[1,1]]),infinite:[]};case n.Profession.Maun1:return{finite:i(e,[[-2,-2],[-2,2],[2,2],[2,-2]]),infinite:[]};case n.Profession.Nuak1:return{finite:[],infinite:s(e,E,t)};case n.Profession.Gua2:return{finite:[],infinite:s(e,[...E,...w,...g,...y],t)};case n.Profession.Kua2:return{finite:i(e,[[0,-1],[0,1]]),infinite:s(e,[...E,...w],t)};case n.Profession.Tuk2:return{finite:i(e,[[-1,0],[1,0]]),infinite:s(e,[...g,...y],t)};case n.Profession.Uai1:return{finite:i(e,[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,1]]),infinite:[]};default:return o.prof}}},7630(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.DICTIONARY=o.GAME_END_LINZKLAR=o.TACTICS_LINZKLAR=void 0,o.TACTICS_LINZKLAR={victory_almost_certain:"我須上行。",strengthened_shaman:"為激巫。",free_lunch:"我為無与之手。",avoid_defeat:"心為此而無行下行之道。",loss_almost_certain:"為何即下行。行我心之道。",neutral:"無心来為何善。行周時無下行之道。"},o.GAME_END_LINZKLAR={victory:"汝上行終",draw:"汝値同於我",loss:"汝下行終"},o.DICTIONARY={ja:{failedWaterEntry:"入水判定に失敗しました。",newSeason:["","季節が改まり夏になりました。","季節が改まり秋になりました。","季節が改まり冬になりました。"],gameEnd:"試合終了です。",gameResult:{victory:"あなたの勝ちです",draw:"引き分けです",loss:"あなたの負けです"},tactics:{victory_almost_certain:"勝ち確",strengthened_shaman:"激巫作成",free_lunch:"ただ取り",avoid_defeat:"負けを避けるためにこう指してみるか",loss_almost_certain:"なにやっても負けそうなので好き勝手に指す",neutral:"いい手が思いつかなかったので、即負けしない範囲で好き勝手に指す"},tymokExplanation:"再行; シーズン続行; こいこい",taxotExplanation:"終季; シーズン終了; 点数獲得",pieceSteppingExplanation:"駒を踏む",pieceTakingExplanation:"駒を取る"}}},7632(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isPromiseLike=o.isntPromiseLike=o.isntPromise=o.isPromise=void 0;const r=t(1506),n=t(4761);function i(e){return e instanceof Promise}function a(e){return(0,r.isObject)(e)&&(0,n.isFunction)(e.then)}o.isPromise=i,o.isntPromise=function(e){return!i(e)},o.isntPromiseLike=function(e){return!a(e)},o.isPromiseLike=a},7728(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.inEnum=void 0,o.inEnum=function(e,o){return Object.values(o).includes(e)}},7927(e,o,t){"use strict";var r,n=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(o,t);n&&!("get"in n?!o.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,n)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var o=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[o.length]=t);return o},r(e)},function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t=r(e),a=0;a<t.length;a++)"default"!==t[a]&&n(o,e,t[a]);return i(o,e),o});Object.defineProperty(o,"__esModule",{value:!0}),o.drawCiurlWithAudio=j,o.animateProcessDeterminingWhoGoesFirst=async function(e){for(const[o,t]of e.process)(0,y.drawTwoCiurls)([o,t]),g.KRUT_CRUOP&&new Audio("sound/ciurl4.ogg").play(),await new Promise((e=>setTimeout(e,500*.8093)))},o.selectOwnPieceOnBoard=function(e,o){if((0,y.eraseGuide)(),null!=b&&"Hop1zuo1"!==b[0]&&(0,u.coordEq)(b,e))b=null;else{b=e;const t=document.getElementById("contains_guides"),r=(0,s.createPieceSizeImageOnBoardByPath)(e,"selection2","selection");r.style.cursor="pointer",r.addEventListener("click",(function(){(0,y.eraseGuide)(),b=null})),t.appendChild(r);const{finite:n,infinite:i}=(0,_.calculateMovablePositions)(e,o,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue);!function(e,o,t,r){for(let n=0;n<r.length;n++){const i=(0,s.createGuideImageAt)(r[n],"yellow_circle");i.addEventListener("click",(async function(){(0,y.eraseGuide)(),await G(o,e,r[n],!0)})),i.addEventListener("contextmenu",(async function(t){(0,y.eraseGuide)(),t.preventDefault(),await G(o,e,r[n],!1)})),t.appendChild(i)}}(e,o,t,[...n,...i])}},o.selectOwnPieceOnHop1zuo1=function(e,o,t){if((0,y.eraseGuide)(),null==b||"Hop1zuo1"!==b[0]||b[1]!==e){b=["Hop1zuo1",e];const r=document.getElementById("contains_guides_on_upward"),n=140,i=1+(f.MAX_PIECE_SIZE-f.PIECE_SIZE)/2,a=n-f.PIECE_SIZE-i,c=(0,s.createPieceSizeImageOnBoardByPathAndXY)(a,(0,f.hop1_zuo1_left_position)({ind:e,list_length:t}),"selection2","selection");c.style.cursor="pointer",c.addEventListener("click",(function(){(0,y.eraseGuide)(),b=null})),r.appendChild(c);const u=document.getElementById("contains_guides");for(let e=0;e<9;e++)for(let t=0;t<9;t++){const r=[e,t];if(null!=l.GAME_STATE.f.currentBoard[e][t])continue;const n=(0,s.createGuideImageAt)(r,"yellow_circle");n.addEventListener("click",(function(){if((0,y.eraseGuide)(),null!=l.GAME_STATE.f.currentBoard[r[0]][r[1]])throw alert("Cannot parachute onto an occupied square"),new Error("Cannot parachute onto an occupied square");const e=(0,l.toAbsoluteCoord)(r);k({type:"NonTamMove",data:{type:"FromHand",color:o.color,prof:o.prof,dest:e}})})),u.appendChild(n)}}else b=null};const s=t(2167),l=t(5562),c=t(627),u=t(8322),d=t(592),_=t(8322),f=t(2443),p=t(7630),m=t(3075),E=t(9784),w=a(t(8442)),g=t(4068),y=t(8549),T=t(6418),A=t(1493),h=t(5746),v=t(5885),S=t(1848);let b=null;function P(e){const o=I();return console.log("drawField #",1.1),(0,h.drawField)({focus:e}),o}function I(){(0,y.eraseGuide)(),(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),(0,v.remove_cover)("protective_cover_over_field");const e=l.GAME_STATE.backupDuringStepping,o=e[0],t=e[1];return l.GAME_STATE.f.currentBoard[o[0]][o[1]]=t,(0,l.back_up_gamestate)(),l.GAME_STATE.backupDuringStepping=null,(0,l.back_up_gamestate)(),b=null,console.log("drawField #",1),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus}),{piece_moved:t,maybe_capture:null}}function O(e,o,t){(0,y.eraseGuide)(),(0,v.add_cover)("protective_tam_cover_over_field"),(0,v.remove_cover)("protective_cover_over_field"),l.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[o[0]][o[1]]="Tam2",(0,l.back_up_gamestate)(),console.log("drawField #",4.1),(0,h.drawField)({focus:null}),(0,y.drawPhantomAt)(e,"Tam2"),(0,y.drawCancelButtonAndAddEscEvent)((()=>{(0,y.eraseGuide)(),(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),(0,v.remove_cover)("protective_tam_cover_over_field"),(0,v.remove_cover)("protective_cover_over_field"),l.GAME_STATE.f.currentBoard[o[0]][o[1]]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[e[0]][e[1]]="Tam2",(0,l.back_up_gamestate)(),b=null,console.log("drawField #",5.1),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus})})),function(o){const r=document.getElementById("contains_phantom"),n=(0,s.createPieceSizeImageOnBoardByPath)(o,(0,d.toPath_)("Tam2"),"piece_image_on_board");n.style.zIndex="100",n.style.cursor="pointer";const i=function(){const r=document.getElementById("contains_guides"),n=(0,s.createPieceSizeImageOnBoardByPath)(o,"selection2","selection");n.style.cursor="pointer",n.style.zIndex="200",r.appendChild(n);const{finite:i,infinite:a}=(0,_.calculateMovablePositions)(o,"Tam2",l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue);if(a.length>0)throw new Error("should not happen");for(let n=0;n<i.length;n++){const[a,c]=i[n],u=l.GAME_STATE.f.currentBoard[a][c];if(void 0!==t&&null!==u)continue;const d=(0,s.createGuideImageAt)(i[n],"yellow_diamond_for_tam");null===u?d.addEventListener("click",(()=>{const r=e,a=o,s=i[n];console.assert(null==l.GAME_STATE.f.currentBoard[s[0]][s[1]]);const c=t?{type:"TamMove",stepStyle:"StepsDuringFormer",src:(0,l.toAbsoluteCoord)(r),step:(0,l.toAbsoluteCoord)(t),firstDest:(0,l.toAbsoluteCoord)(a),secondDest:(0,l.toAbsoluteCoord)(s)}:{type:"TamMove",stepStyle:"NoStep",src:(0,l.toAbsoluteCoord)(r),firstDest:(0,l.toAbsoluteCoord)(a),secondDest:(0,l.toAbsoluteCoord)(s)};(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),(0,y.eraseGuide)(),k(c),(0,v.remove_cover)("protective_tam_cover_over_field")})):d.addEventListener("click",(function(){var t,r,a;t=e,r=o,a=i[n],(0,y.eraseGuide)(),(0,v.add_cover)("protective_cover_over_field"),(0,v.add_cover)("protective_tam_cover_over_field"),l.GAME_STATE.backupDuringStepping=[r,"Tam2"],(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[r[0]][r[1]]=null,(0,l.back_up_gamestate)(),document.getElementById("cancelButton").remove(),console.log("drawField #",2),(0,h.drawField)({focus:null}),(0,y.drawPhantomAt)(r,"Tam2"),(0,y.drawCancelButtonAndAddEscEvent)((()=>{(0,y.eraseGuide)(),(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),(0,v.remove_cover)("protective_cover_over_field"),(0,v.remove_cover)("protective_tam_cover_over_field"),l.GAME_STATE.f.currentBoard[t[0]][t[1]]="Tam2",(0,l.back_up_gamestate)(),l.GAME_STATE.backupDuringStepping=null,(0,l.back_up_gamestate)(),b=null,console.log("drawField #",3.1),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus})})),(0,y.drawHoverAt_)(a,"Tam2",((e,o)=>{const n=document.getElementById("contains_guides"),i=(0,s.createPieceSizeSelectionButtonOnBoard_Shifted)(e);n.appendChild(i);const{finite:c,infinite:u}=(0,_.calculateMovablePositions)(e,o,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue);if(u.length>0)throw new Error("should not happen");for(let e=0;e<c.length;e++){const o=c[e],[i,u]=o;if(null!==l.GAME_STATE.f.currentBoard[i][u])continue;const d=(0,s.createGuideImageAt)(o,"yellow_diamond_for_tam");d.addEventListener("click",(function(){const e={type:"TamMove",stepStyle:"StepsDuringLatter",src:(0,l.toAbsoluteCoord)(t),step:(0,l.toAbsoluteCoord)(a),firstDest:(0,l.toAbsoluteCoord)(r),secondDest:(0,l.toAbsoluteCoord)(o)};(0,y.eraseGuide)(),(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),k(e),(0,v.remove_cover)("protective_cover_over_field"),(0,v.remove_cover)("protective_tam_cover_over_field")})),d.style.zIndex="200",n.appendChild(d)}}))})),d.style.zIndex="200",r.appendChild(d)}};n.addEventListener("click",i),r.appendChild(n),i()}(o)}function C(e,o,t){(0,y.eraseGuide)(),(0,v.add_cover)("protective_cover_over_field"),l.GAME_STATE.backupDuringStepping=[e,o],(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,(0,l.back_up_gamestate)(),console.log("drawField #",6.2),(0,h.drawField)({focus:null}),(0,y.drawPhantomAt)(e,o),(0,y.drawCancelButtonAndAddEscEvent)(I),(0,y.drawHoverAt_)(t,o,(function(e,o){const t=document.getElementById("contains_guides"),r=(0,s.createPieceSizeSelectionButtonOnBoard_Shifted)(e);t.appendChild(r);const{finite:n,infinite:i}=(0,_.calculateMovablePositions)(e,o,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue);if(K(e,{piece:o,path:"yellow_circle"},t,n),"Tam2"!==o)K(e,{piece:o,path:"green_circle"},t,i);else if(i.length>0)throw new Error("should not happen")}))}async function M(e,o){var t;const r=await(0,h.sendStuffTo)("decision/afterhalfacceptance","`after half acceptance`",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===r.type)throw alert(`Illegal API sent, the reason being ${r.why_illegal}`),new Error(`Illegal API sent, the reason being ${r.why_illegal}`);if("WithoutWaterEntry"===r.type){(0,y.eraseGuide)(),b=null;const t=N(e,o.src,o.step),r=(()=>{if("Tam2"===t.piece_moved)throw new Error("Tam2 was passed to piece_moved");return(0,T.serializeProf)(t.piece_moved.prof)})();return console.log("drawField #",7),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus}),l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)(),void(e.dest?w.push_body_elem_and_display({type:"movement",dat:`${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.src))}${r}${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.step))}${(0,T.serializeAbsoluteCoord)(e.dest)}橋${(0,T.serializeCiurl)(o.stepping_ciurl)}`,piece_capture_comment:(0,A.toPieceCaptureComment)(t.maybe_capture)}):w.push_body_elem_and_display({type:"movement",dat:`${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.src))}${r}${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.step))}${(0,T.serializeAbsoluteCoord)(o.planned_destination)}橋${(0,T.serializeCiurl)(o.stepping_ciurl)}此無`,piece_capture_comment:(0,A.toPieceCaptureComment)(t.maybe_capture)}))}if(await(0,y.animateWaterEntryLogo)(),j(r.ciurl),await new Promise((e=>setTimeout(e,500*.8093))),r.ciurl.filter((e=>e)).length<3){await(0,y.notifyWaterEntryFailure)(),(0,y.eraseGuide)(),b=null;const n=P(o.src);l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)();const i=(()=>{const e=n.piece_moved;if("Tam2"===e)throw new Error("Tam2 encountered in the backup even though we are in sendAfterAcceptance");return(0,T.serializeProf)(e.prof)})(),a=null!==(t=e.dest)&&void 0!==t?t:(()=>{throw new Error("This should not happen; it should have been rejected before the water entry")})();w.push_body_elem_and_display({type:"movement",dat:`${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.src))}${i}${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.step))}${(0,T.serializeAbsoluteCoord)(a)}橋${(0,T.serializeCiurl)(o.stepping_ciurl)}水${(0,T.serializeCiurl)(r.ciurl)}此無`})}else{(0,y.eraseGuide)(),b=null;const t=N(e,o.src,o.step);console.log("drawField #",8),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus}),l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)();const n=(()=>{if("Tam2"===t.piece_moved)throw new Error("Tam2 was passed to `piece_moved`");return(0,T.serializeProf)(t.piece_moved.prof)})();if(!e.dest)throw new Error("This should not happen; it should have been rejected before the water entry");w.push_body_elem_and_display({type:"movement",dat:`${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.src))}${n}${(0,T.serializeAbsoluteCoord)((0,l.toAbsoluteCoord)(o.step))}${(0,T.serializeAbsoluteCoord)(e.dest)}橋${(0,T.serializeCiurl)(o.stepping_ciurl)}水${(0,T.serializeCiurl)(r.ciurl)}`,piece_capture_comment:(0,A.toPieceCaptureComment)(t.maybe_capture)})}}async function k(e){const o=await(0,h.sendStuffTo)("decision/normalmove","normal move",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===o.type)throw alert(`Illegal API sent, the reason being ${o.why_illegal}`),new Error(`Illegal API sent, the reason being ${o.why_illegal}`);if("WithoutWaterEntry"===o.type){(0,y.eraseGuide)(),b=null;const o=B(e);return console.log("drawField #",9),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus}),l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)(),void w.push_body_elem_and_display({type:"movement",dat:(0,T.normalMoveToKiarArk)(e,{piece_moved:o.piece_moved}),piece_capture_comment:(0,A.toPieceCaptureComment)(o.maybe_capture)})}if(await(0,y.animateWaterEntryLogo)(),j(o.ciurl),await new Promise((e=>setTimeout(e,500*.8093))),o.ciurl.filter((e=>e)).length<3){if(await(0,y.notifyWaterEntryFailure)(),(0,y.eraseGuide)(),b=null,"NonTamMove"===e.type&&"SrcStepDstFinite"===e.data.type){const t=P((0,l.fromAbsoluteCoord)(e.data.src));l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)(),w.push_body_elem_and_display({type:"movement",dat:(0,T.normalMoveToKiarArk)(e,{water_ciurl_count:o.ciurl.filter((e=>e)).length,piece_moved:t.piece_moved})})}else if("NonTamMove"===e.type&&"FromHand"!==e.data.type){console.log("drawField #",10.1),(0,h.drawField)({focus:(0,l.fromAbsoluteCoord)(e.data.src)}),l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)();const[t,r]=(0,l.fromAbsoluteCoord)(e.data.src),n=l.GAME_STATE.f.currentBoard[t][r];if(null===n)throw new Error("Cannot happen");w.push_body_elem_and_display({type:"movement",dat:(0,T.normalMoveToKiarArk)(e,{water_ciurl_count:o.ciurl.filter((e=>e)).length,piece_moved:n})})}}else{(0,y.eraseGuide)(),b=null;const t=B(e);console.log("drawField #",10),(0,h.drawField)({focus:l.GAME_STATE.last_move_focus}),l.GAME_STATE.is_my_turn=!1,(0,l.back_up_gamestate)(),w.push_body_elem_and_display({type:"movement",dat:(0,T.normalMoveToKiarArk)(e,{piece_moved:t.piece_moved,water_ciurl_count:o.ciurl.filter((e=>e)).length}),piece_capture_comment:(0,A.toPieceCaptureComment)(t.maybe_capture)})}}function N(e,o,t){if(console.log(o,t),null===e.dest){const e=I();return console.log("lone assignment to last_move_focus, #",0),l.GAME_STATE.last_move_focus=o,(0,l.back_up_gamestate)(),{piece_moved:e.piece_moved,maybe_capture:null}}const[r,n]=(0,l.fromAbsoluteCoord)(e.dest),i=l.GAME_STATE.backupDuringStepping[1];I();const[a,s]=o,[c,d]=t;if(null===l.GAME_STATE.f.currentBoard[c][d])throw new Error("step is unoccupied");const _=l.GAME_STATE.f.currentBoard[r][n];return(0,u.coordEq)([a,s],[r,n])?(console.log("lone assignment to last_move_focus, #",1),l.GAME_STATE.last_move_focus=[a,s],(0,l.back_up_gamestate)(),{piece_moved:i,maybe_capture:null}):(null!==_&&D(_),l.GAME_STATE.f.currentBoard[a][s]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[r][n]=i,(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",2),l.GAME_STATE.last_move_focus=[r,n],(0,l.back_up_gamestate)(),{piece_moved:i,maybe_capture:(0,A.toColorProf)(_)})}function D(e){const o=(()=>{if("Tam2"===e)throw new Error("dest is occupied by Tam2");if(e.side===u.Side.Upward)throw new Error("dest is occupied by an ally");if(e.side===u.Side.Downward)return{color:e.color,prof:e.prof,side:u.Side.Upward};throw e.side,new Error("should not reach here")})(),t=(0,h.calculateHandsAndScore)(l.GAME_STATE.f.hop1zuo1OfUpward);l.GAME_STATE.f.hop1zuo1OfUpward.push(o),(0,l.back_up_gamestate)();const r=(0,h.calculateHandsAndScore)(l.GAME_STATE.f.hop1zuo1OfUpward);r.score!==t.score&&(setTimeout((()=>{(0,m.drawScoreDisplay)(r.hands);const e=r.score,o=document.getElementById("score_display"),t=(0,s.createImageButton)("再行",0,"x-faikleone"===sessionStorage.lang?"":p.DICTIONARY.ja.tymokExplanation);t.addEventListener("click",(async()=>{if((0,h.increaseRateAndAnimate)(!0),"Ok"!==(await(0,h.sendStuffTo)("decision/tymok","`send whether ty mok1`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)))).type)throw new Error("bad!!!!");w.push_body_elem_and_display({type:"tymoktaxot",dat:`或為${r.hands.join("加")}\n再行`})})),o.appendChild(t);const n=(0,s.createImageButton)("終季",250,"x-faikleone"===sessionStorage.lang?"":p.DICTIONARY.ja.taxotExplanation);n.addEventListener("click",(async()=>{const o=await(0,h.sendStuffTo)("decision/taxot","`send whether ty mok1`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Ok"!==o.type)throw new Error("bad!!!!");const t=o.is_first_move_my_move,n=["春","夏","秋","冬"][l.GAME_STATE.season];(0,h.endSeason)(e,t),w.push_body_elem_and_display({type:"tymoktaxot",dat:`或為${r.hands.join("加")}而手${(0,E.toDigitsLinzklar)(e*Math.pow(2,l.GAME_STATE.log2_rate)).join("")}\n終季\t${n}終`})})),o.appendChild(n)}),1e3*.8093),(0,c.forbidMainPolling)())}function B(e){if("NonTamMove"===e.type){if("FromHand"===e.data.type){const o=e.data,t=l.GAME_STATE.f.hop1zuo1OfUpward.findIndex((e=>e.color===o.color&&e.prof===o.prof));if(-1===t)throw new Error("What should exist in the hand does not exist");const[r]=l.GAME_STATE.f.hop1zuo1OfUpward.splice(t,1),[n,i]=(0,l.fromAbsoluteCoord)(o.dest);if(null!==l.GAME_STATE.f.currentBoard[n][i])throw new Error("Trying to parachute the piece onto an occupied space");return l.GAME_STATE.f.currentBoard[n][i]=r,(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",3),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),{piece_moved:r,maybe_capture:null}}if("SrcDst"===e.data.type){const o=e.data,[t,r]=(0,l.fromAbsoluteCoord)(o.src),[n,i]=(0,l.fromAbsoluteCoord)(o.dest),a=l.GAME_STATE.f.currentBoard[t][r];if(null===a)throw new Error("src is unoccupied");const s=l.GAME_STATE.f.currentBoard[n][i];return null!==s&&D(s),l.GAME_STATE.f.currentBoard[t][r]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[n][i]=a,(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",4),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),{piece_moved:a,maybe_capture:(0,A.toColorProf)(s)}}if("SrcStepDstFinite"===e.data.type){const o=e.data,[t,r]=(0,l.fromAbsoluteCoord)(o.src),[n,i]=(0,l.fromAbsoluteCoord)(o.dest),a=l.GAME_STATE.backupDuringStepping[1];I();const[s,c]=(0,l.fromAbsoluteCoord)(o.step);if(null===l.GAME_STATE.f.currentBoard[s][c])throw new Error("step is unoccupied");const d=l.GAME_STATE.f.currentBoard[n][i];return(0,u.coordEq)([t,r],[n,i])?(l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",4.5),{piece_moved:a,maybe_capture:null}):(null!==d&&D(d),l.GAME_STATE.f.currentBoard[t][r]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[n][i]=a,(0,l.back_up_gamestate)(),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",5),{piece_moved:a,maybe_capture:(0,A.toColorProf)(d)})}throw e.data,new Error("should not reach here")}if("TamMove"===e.type){const o=e,[t,r]=(0,l.fromAbsoluteCoord)(o.firstDest),[n,i]=(0,l.fromAbsoluteCoord)(o.secondDest);if("StepsDuringLatter"===e.stepStyle)return l.GAME_STATE.f.currentBoard[n][i]="Tam2",(0,l.back_up_gamestate)(),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",6),{piece_moved:"Tam2",maybe_capture:null};const a=l.GAME_STATE.f.currentBoard[t][r];if(null===a)throw new Error("firstDest is unoccupied");if("Tam2"!==a)throw new Error("TamMove but not Tam2");return(0,u.coordEq)([t,r],[n,i])?(l.GAME_STATE.last_move_focus=[n,i],console.log("lone assignment to last_move_focus, #",7),{piece_moved:"Tam2",maybe_capture:null}):(l.GAME_STATE.f.currentBoard[t][r]=null,(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[n][i]=a,(0,l.back_up_gamestate)(),l.GAME_STATE.last_move_focus=[n,i],(0,l.back_up_gamestate)(),console.log("lone assignment to last_move_focus, #",8),{piece_moved:"Tam2",maybe_capture:null})}throw new Error("should not reach here")}function G(e,o,t,r){if(null==l.GAME_STATE.f.currentBoard[t[0]][t[1]]){let r;return"Tam2"!==e?(r={type:"NonTamMove",data:{type:"SrcDst",src:(0,l.toAbsoluteCoord)(o),dest:(0,l.toAbsoluteCoord)(t)}},void k(r)):void O(o,t)}if(!(0,_.canGetOccupiedBy)(u.Side.Upward,t,e,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue))return void C(o,e,t);if(!r)return void C(o,e,t);const n=document.getElementById("whether_to_take_or_step");n.classList.remove("nocover"),(0,S.removeAllChildren)(n),document.getElementById("yaku_all").style.left="790px";const i=(0,s.createImageButton)("手此",0,"x-faikleone"===sessionStorage.lang?"":p.DICTIONARY.ja.pieceTakingExplanation);!function(e,o,t){(0,y.eraseGuide)(),(0,v.add_cover)("protective_cover_over_field"),l.GAME_STATE.backupDuringStepping=[e,o],(0,l.back_up_gamestate)(),l.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,(0,l.back_up_gamestate)(),console.log("drawField #",6.1),(0,h.drawField)({focus:null}),(0,y.drawPhantomAt)(e,o),(0,y.drawCancelButtonAndAddEscEvent)((()=>R({draw_the_field:!0}))),(0,y.drawHoverAt_)(t,o,(function(e,o){const t=document.getElementById("contains_guides"),r=(0,s.createPieceSizeSelectionButtonOnBoard_Shifted)(e);t.appendChild(r)}))}(o,e,t),i.addEventListener("click",(()=>{R({draw_the_field:!1}),k({type:"NonTamMove",data:{type:"SrcDst",src:(0,l.toAbsoluteCoord)(o),dest:(0,l.toAbsoluteCoord)(t)}})})),n.appendChild(i);const a=(0,s.createImageButton)("撃此",250,"x-faikleone"===sessionStorage.lang?"":p.DICTIONARY.ja.pieceSteppingExplanation);a.addEventListener("click",(()=>{R({draw_the_field:!1}),C(o,e,t)})),n.appendChild(a)}function R(e){document.getElementById("whether_to_take_or_step").classList.add("nocover"),document.getElementById("yaku_all").style.left="750px",(0,y.eraseGuide)(),(0,y.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent)(),(0,v.remove_cover)("protective_cover_over_field");const o=l.GAME_STATE.backupDuringStepping,t=o[0],r=o[1];l.GAME_STATE.f.currentBoard[t[0]][t[1]]=r,(0,l.back_up_gamestate)(),l.GAME_STATE.backupDuringStepping=null,(0,l.back_up_gamestate)(),e.draw_the_field&&(0,h.drawField)({focus:l.GAME_STATE.last_move_focus})}function $(e){const[o,t]=e;return"Tam2"===l.GAME_STATE.f.currentBoard[o][t]}function L(e,o,t,r){if("Tam2"===t)return void O(e,r,o);const n={type:"NonTamMove",data:{type:"SrcStepDstFinite",step:(0,l.toAbsoluteCoord)(o),dest:(0,l.toAbsoluteCoord)(r),src:(0,l.toAbsoluteCoord)(e)}};$(o)?(async()=>{await(0,y.animateStepTamLogo)(),await(0,h.animatePunishStepTamAndCheckPerzej)(u.Side.Upward),await k(n)})():k(n)}async function U(e,o){const t=await(0,h.sendStuffTo)("decision/infafterstep","inf after step",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if("Err"===t.type)throw alert(`Illegal API sent, the reason being ${t.why_illegal}`),new Error(`Illegal API sent, the reason being ${t.why_illegal}`);$((0,l.fromAbsoluteCoord)(e.step))&&(await(0,y.animateStepTamLogo)(),await(0,h.animatePunishStepTamAndCheckPerzej)(u.Side.Upward)),j(t.ciurl),document.getElementById("cancelButton").remove(),(0,y.eraseGuide)();const r=(0,l.fromAbsoluteCoord)(e.step),n=(0,l.fromAbsoluteCoord)(e.plannedDirection),i=(0,s.createPieceSizeImageOnBoardByPath_Shifted)(r,"selection2","selection");i.style.zIndex="200";const a=document.getElementById("contains_guides");a.appendChild(i);const c={color:o.color,prof:o.prof,side:u.Side.Upward},{infinite:d}=(0,_.calculateMovablePositions)(r,c,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue),f=function(e,o,t,r){return e.filter((e=>{const n=function([e,t]){const[r,n]=o;return[e-r,t-n]},i=r.filter((e=>e)).length,[a,s]=n(e),[l,c]=n(t);return a*c-l*s==0&&a*l+s*c>0&&Math.max(Math.abs(a),Math.abs(s))<=i}))}(d,r,n,t.ciurl),p=(0,l.fromAbsoluteCoord)(e.src),m=(0,s.createGuideImageAt)(p,"yellow_circle");m.addEventListener("click",(function(o){(0,y.eraseGuide)(),M({type:"AfterHalfAcceptance",dest:null},{src:p,step:r,stepping_ciurl:t.ciurl,planned_destination:e.plannedDirection})})),m.style.zIndex="200",a.appendChild(m);for(let o=0;o<f.length;o++){const n=f[o];if((0,u.coordEq)(p,n))continue;if(!(0,_.canGetOccupiedByNonTam)(u.Side.Upward,n,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue))continue;const i=(0,s.createGuideImageAt)(f[o],"green_circle");i.addEventListener("click",(function(o){M({type:"AfterHalfAcceptance",dest:(0,l.toAbsoluteCoord)(n)},{src:p,step:r,stepping_ciurl:t.ciurl,planned_destination:e.plannedDirection})})),i.style.zIndex="200",a.appendChild(i)}}function j(e,o){(0,y.drawCiurl)(e,o),g.KRUT_CRUOP&&new Audio("sound/ciurl4.ogg").play()}function K(e,o,t,r){const n=b;if(null==n)throw new Error("though stepping, null startpoint!!!!!");if("Hop1zuo1"===n[0])throw new Error("though stepping, hop1zuo1 startpoint!!!!!");for(let i=0;i<r.length;i++){if(!(0,_.canGetOccupiedBy)(u.Side.Upward,r[i],o.piece,l.GAME_STATE.f.currentBoard,l.GAME_STATE.tam_itself_is_tam_hue)){const[e,n]=r[i],a=l.GAME_STATE.f.currentBoard[e][n];if("Tam2"!==o.piece&&"Tam2"!==a&&null!==a&&a.side===u.Side.Downward){const e=(0,s.createGuideImageAt)(r[i],"守");e.style.zIndex="200",t.append(e)}continue}const a=(0,s.createGuideImageAt)(r[i],o.path);a.addEventListener("click","yellow_circle"===o.path?function(){(0,y.eraseGuide)(),L(n,e,o.piece,r[i])}:function(){(0,y.eraseGuide)(),U({type:"InfAfterStep",step:(0,l.toAbsoluteCoord)(e),plannedDirection:(0,l.toAbsoluteCoord)(r[i]),src:(0,l.toAbsoluteCoord)(n)},{color:o.piece.color,prof:o.piece.prof})}),a.style.zIndex="200",t.appendChild(a)}}window.addEventListener("keydown",(e=>{if(!e.defaultPrevented){switch(e.key){case"Esc":case"Escape":(0,y.WHAT_ESC_KEY_TRIGGERS)();break;default:return}e.preventDefault()}}),!0)},7973(){},8003(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0})},8065(e,o){"use strict";function t(e){return void 0===e}Object.defineProperty(o,"__esModule",{value:!0}),o.isntUndefined=o.isUndefined=void 0,o.isUndefined=t,o.isntUndefined=function(e){return!t(e)}},8322(e,o,t){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),n=this&&this.__exportStar||function(e,o){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(o,t)||r(o,e,t)};Object.defineProperty(o,"__esModule",{value:!0}),n(t(7063),o),n(t(1892),o),n(t(2918),o),n(t(3218),o)},8442(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.display_kiar_ark=i,o.push_initial_colors_and_display=function(e){n.initial_colors.push(e),i()},o.push_body_elem_and_display=function(e){n.body.push(e),i()},o.push_header_elem_and_display=function(e){n.header.push(e),i()},o.resurrect=function(e){n.header=e.header,n.initial_colors=e.initial_colors,n.body=e.body};const r=t(5562),n={header:[],body:[],initial_colors:[]};function i(){sessionStorage.kiar_ark=JSON.stringify(n),console.log("_kiar_ark:",n);const e=`{一位色:${n.initial_colors.join("")}}\n`+n.header.map((e=>e.dat)).join("\n")+"\n"+function(e){var o,t,r,n;let i="";for(let a=0;a<e.length;){const s=e[a],l=e[a+1];if("movement"===(null==s?void 0:s.type)&&"movement"===(null==l?void 0:l.type))i+=s.dat+(null!==(o=s.piece_capture_comment)&&void 0!==o?o:"")+"\t"+l.dat+(null!==(t=l.piece_capture_comment)&&void 0!==t?t:"")+"\n",a+=2;else if("tymoktaxot"===(null==s?void 0:s.type))i+="\n"+s.dat+"\n\n",a+=1;else if("movement"===(null==s?void 0:s.type)&&"tymoktaxot"===(null==l?void 0:l.type))i+=s.dat+(null!==(r=s.piece_capture_comment)&&void 0!==r?r:"")+"\n\n"+l.dat+"\n\n",a+=2;else{if("movement"!==(null==s?void 0:s.type)||void 0!==l)throw new Error(`Unexpected: the types passed to KIAR_ARK.body are "${null==s?void 0:s.type}" followed by "${null==l?void 0:l.type}".`);i+=s.dat+(null!==(n=s.piece_capture_comment)&&void 0!==n?n:"")+"\n",a+=1}}return i}(n.body);document.getElementById("kiar_ark").textContent=e,document.getElementById("kiar_ark_link").href=`https://sozysozbot.github.io/cetkaik_platform/show_history.html?side=${r.GAME_STATE.IA_is_down?"ia":"a"}&history=${encodeURIComponent(e)}`}},8481(e,o){"use strict";function t(e){return e instanceof Date}Object.defineProperty(o,"__esModule",{value:!0}),o.isntDate=o.isDate=void 0,o.isDate=t,o.isntDate=function(e){return!t(e)}},8549(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.WHAT_ESC_KEY_TRIGGERS=void 0,o.animateNode=async function(e,o,t,r="100",n){e.style.transition=`transform ${o/1e3}s ease`,e.style.zIndex=r,e.style.transform=`translateY(${t.to.top-t.from.top}px)`,e.style.transform+=`translateX(${t.to.left-t.from.left}px)`,null!=n&&(e.style.transform+=`rotate(${n}deg)`),await new Promise((e=>setTimeout(e,o)))},o.animateStepTamLogo=async function(){const e=document.getElementById("step_tam_logo");e.style.display="block",e.classList.add("step_tam"),(0,l.add_cover)("protective_cover_over_field_while_asyncawait"),setTimeout((()=>{e.style.display="none",(0,l.remove_cover)("protective_cover_over_field_while_asyncawait")}),971.16),await new Promise((e=>setTimeout(e,1e3*.8093)))},o.animateWaterEntryLogo=async function(){const e=document.getElementById("water_entry_logo");e.style.display="block",e.classList.add("water_entry"),(0,l.add_cover)("protective_cover_over_field_while_asyncawait"),setTimeout((()=>{e.style.display="none",(0,l.remove_cover)("protective_cover_over_field_while_asyncawait")}),971.16),await new Promise((e=>setTimeout(e,1e3*.8093)))},o.notifyWaterEntryFailure=async function(){await new Promise((e=>setTimeout(e,242.79))),await new Promise(((e,o)=>{const t=document.getElementById("season_transition_message_or_water_entry_failure_message");t.onload=()=>e(t),t.onerror=e=>o(e),t.src="image/裁言勿入水.png"})),(0,l.add_cover)("protective_cover_over_field"),(0,l.add_cover)("protective_cover_over_field_while_asyncawait"),u.KRUT_CRUOP&&(new Audio("sound/water_entry.wav").play(),await new Promise((e=>setTimeout(e,500*.8093)))),document.getElementById("season_transition_message_or_water_entry_failure_message_container").classList.remove("nocover"),await new Promise((e=>setTimeout(e,1375.81))),"x-faikleone"!==sessionStorage.lang&&alert(c.DICTIONARY.ja.failedWaterEntry),await new Promise((e=>setTimeout(e,242.79))),(0,l.remove_cover)("protective_cover_over_field"),(0,l.remove_cover)("protective_cover_over_field_while_asyncawait"),document.getElementById("season_transition_message_or_water_entry_failure_message_container").classList.add("nocover")},o.drawCiurl=function(e,o){_(),d(document.getElementById("contains_ciurl"),e,o)},o.drawTwoCiurls=function(e){_(),d(document.getElementById("contains_ciurl"),e[0],r.Side.Upward),d(document.getElementById("contains_ciurl"),e[1],r.Side.Downward)},o.eraseGuide=function(){(0,s.removeAllChildren)(document.getElementById("contains_guides")),(0,s.removeAllChildren)(document.getElementById("contains_guides_on_upward"))},o.erasePhantomAndOptionallyCancelButtonWhileAlsoRemovingEscEvent=f,o.eraseArrow=function(){(0,s.removeAllChildren)(document.getElementById("arrows"))},o.drawPhantomAt=function(e,o){const t=document.getElementById("contains_phantom");f();const r=(0,n.createPieceImgToBePlacedOnBoard)(e,o);r.style.opacity="0.1",t.appendChild(r)},o.drawHoverAt_=function(e,o,t){const r=document.getElementById("contains_phantom"),i=(0,n.createPieceSizeImageOnBoardByPath_Shifted)(e,(0,a.toPath_)(o),"piece_image_on_board");i.style.zIndex="100",i.style.cursor="pointer";const s=function(){t(e,o)};i.addEventListener("click",s),r.appendChild(i),s()},o.drawCancelButtonAndAddEscEvent=function(e){const t=document.getElementById("contains_phantom"),r=(0,n.createCancelButton)();r.width=80,r.height=80,r.style.zIndex="100",r.style.cursor="pointer",r.setAttribute("id","cancelButton"),r.addEventListener("click",e),o.WHAT_ESC_KEY_TRIGGERS=e,t.appendChild(r)},o.drawArrow=function(e,o){const t=(()=>{if(e[1]===o[1]&&e[0]>o[0]){const t=e[0]-o[0];return`m31.6 ${51.3+i.BOX_SIZE*t}h5.8v${-(34.5+i.BOX_SIZE*t)}l-21.3 31 4.5 3.2 11-16z`}if(e[1]===o[1]&&e[0]<o[0]){const t=o[0]-e[0];return`m31.6 18.7h5.8v${34.5+i.BOX_SIZE*t}l-21.3-31 4.5-3.2 11 16z`}if(e[0]===o[0]&&e[1]>o[1]){const t=e[1]-o[1];return`m${51.3+i.BOX_SIZE*t} 31.6v5.8h${-(34.5+i.BOX_SIZE*t)}l31-21.3 3.2 4.5-16 11z`}if(e[0]===o[0]&&e[1]<o[1]){const t=o[1]-e[1];return`m18.7 31.6v5.8h${34.5+i.BOX_SIZE*t}l-31-21.3-3.2 4.5 16 11z`}if(e[0]>o[0]&&e[1]<o[1]&&e[0]-o[0]==o[1]-e[1]){const t=e[0]-o[0];return`m${32.9+i.BOX_SIZE*t} 34.8-19.8 5.6-1.8-5.9 41-10.7 ${-(32.4+i.BOX_SIZE*t)} ${32.4+i.BOX_SIZE*t}-4.2-4.2z`}if(e[0]<o[0]&&e[1]>o[1]&&e[0]-o[0]==o[1]-e[1]){const t=e[1]-o[1];return`m34.8 ${32.9+i.BOX_SIZE*t} 5.6-19.8-5.9-1.8-10.7 41 ${32.4+i.BOX_SIZE*t} ${-(32.4+i.BOX_SIZE*t)}-4.2-4.2z`}if(e[0]>o[0]&&e[1]>o[1]&&e[0]-o[0]==e[1]-o[1]){const t=e[1]-o[1];return`m34.8 37.1 5.6 19.8-5.9 1.8-10.7-41 ${32.4+i.BOX_SIZE*t} ${32.4+i.BOX_SIZE*t}-4.2 4.2z`}if(e[0]<o[0]&&e[1]<o[1]&&e[0]-o[0]==e[1]-o[1]){const t=o[0]-e[0];return`m${32.9+i.BOX_SIZE*t} ${35.2+i.BOX_SIZE*t}-19.8-5.6-1.8 5.9 41 10.7 ${-(32.4+i.BOX_SIZE*t)} ${-(32.4+i.BOX_SIZE*t)}-4.2 4.2z`}throw new Error("unsupported direction for the arrow")})(),r=[Math.min(e[0],o[0]),Math.min(e[1],o[1])];document.getElementById("arrows").appendChild((0,n.createArrowSvg)(t,r))};const r=t(8322),n=t(2167),i=t(2443),a=t(592),s=t(1848),l=t(5885),c=t(7630),u=t(4068);function d(e,o,t){const a=function(){let e=0,o=0;for(;0===e;)e=Math.random();for(;0===o;)o=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*o)},s=i.BOX_SIZE*(335/70+a()/6),l=84+(null==t||t===r.Side.Upward?771:0),c=o.map(((e,t)=>(0,n.createCiurl)(e,{left:s+.2*i.BOX_SIZE*a(),top:l+26*(t+.5-o.length/2)+.05*i.BOX_SIZE*a(),rotateDeg:40*Math.random()-20})));for(let e=c.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[c[e],c[o]]=[c[o],c[e]]}for(let o=0;o<c.length;o++)e.appendChild(c[o])}function _(){(0,s.removeAllChildren)(document.getElementById("contains_ciurl"))}function f(){const e=document.getElementById("contains_phantom");for(;e.firstChild;)e.removeChild(e.firstChild);o.WHAT_ESC_KEY_TRIGGERS=()=>{}}o.WHAT_ESC_KEY_TRIGGERS=()=>{}},8879(e,o,t){var r=t(4335)(Object.getPrototypeOf,Object);e.exports=r},8976(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isAbsoluteURL=void 0,o.isAbsoluteURL=function(e){try{return new URL(e),!0}catch(e){return!1}}},9172(e,o){"use strict";function t(e){return"number"==typeof e}function r(e){return Number.isNaN(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.isntNaN=o.isNaN=o.isNegativeInfinity=o.isPositiveInfinity=o.isFinite=o.isntNumber=o.isNumber=void 0,o.isNumber=t,o.isntNumber=function(e){return!t(e)},o.isFinite=function(e){return Number.isFinite(e)},o.isPositiveInfinity=function(e){return e===1/0},o.isNegativeInfinity=function(e){return e===-1/0},o.isNaN=r,o.isntNaN=function(e){return!r(e)}},9325(e,o,t){var r=t(4840),n="object"==typeof self&&self&&self.Object===Object&&self,i=r||n||Function("return this")();e.exports=i},9350(e){var o=Object.prototype.toString;e.exports=function(e){return o.call(e)}},9411(e,o,t){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),n=this&&this.__exportStar||function(e,o){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(o,t)||r(o,e,t)};Object.defineProperty(o,"__esModule",{value:!0}),n(t(9651),o)},9451(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.API_ORIGIN=void 0,o.API_ORIGIN="https://little-water-8645.fly.dev"},9588(e,o){"use strict";function t(e){return e instanceof RegExp}Object.defineProperty(o,"__esModule",{value:!0}),o.isntRegExp=o.isRegExp=void 0,o.isRegExp=t,o.isntRegExp=function(e){return!t(e)}},9641(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isntChar=o.isChar=void 0;const r=t(3296);function n(e){return(0,r.isString)(e)&&1===e.length}o.isChar=n,o.isntChar=function(e){return!n(e)}},9651(e,o){"use strict";var t=this&&this.__read||function(e,o){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,n,i=t.call(e),a=[];try{for(;(void 0===o||o-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return a},r=this&&this.__spread||function(){for(var e=[],o=0;o<arguments.length;o++)e=e.concat(t(arguments[o]));return e};function n(e){return 0===e["王"]["黒"]&&0===e["王"]["赤"]?function(e){function o(o){return e[o]["赤"]+e[o]["黒"]>0}function t(o){return e[o]["赤"]+e[o]["黒"]}var r=new Set;e["兵"]["赤"]>=5||e["兵"]["黒"]>=5?r.add("同色闇戦之集"):t("兵")>=5&&r.add("闇戦之集"),e["車"]["赤"]>=1&&e["兵"]["赤"]>=2||e["車"]["黒"]>=1&&e["兵"]["黒"]>=2?r.add("同色助友"):o("車")&&t("兵")>=2&&r.add("助友"),e["将"]["赤"]>=1&&e["兵"]["赤"]>=2||e["将"]["黒"]>=1&&e["兵"]["黒"]>=2?r.add("同色戦集"):o("将")&&t("兵")>=2&&r.add("戦集");var n=function(t,n,i){var a;(a=t).every((function(o){return e[o]["赤"]>=1}))||a.every((function(o){return e[o]["黒"]>=1}))?r.add(n):function(e){return e.every(o)}(t)&&r.add(i)};return n(["虎","馬"],"同色獣","獣"),n(["船","車","馬"],"同色行行","行行"),n(["兵","弓","馬"],"同色馬弓兵","馬弓兵"),n(["筆","巫","将"],"同色地心","地心"),n(["兵","弓","将","筆","巫"],"同色筆兵無傾","筆兵無傾"),r}(e):function(e){function o(o){return e[o]["赤"]+e[o]["黒"]>0}var t=new Set(["王"]);t.add("王");var i,a=["兵","弓","車","虎","馬","筆","巫","将","船"];(i=r(a,["王"])).every((function(o){return e[o]["赤"]>=1}))||i.every((function(o){return e[o]["黒"]>=1}))?t.add("同色無抗行処"):function(e){return e.every(o)}(r(a,["王"]))&&t.add("無抗行処");var s=function(o){if(1===e["王"][o]){e["王"][o]--;for(var i=0;i<a.length;i++)e[a[i]][o]++,t=new Set(r(t,n(e))),e[a[i]][o]--;e["王"][o]++}};s("赤"),s("黒");var l=function(e,o){t.has(e)&&t.delete(o)};return l("同色助友","助友"),l("同色地心","地心"),l("同色戦集","戦集"),l("同色馬弓兵","馬弓兵"),l("同色獣","獣"),l("同色行行","行行"),l("同色筆兵無傾","筆兵無傾"),l("同色闇戦之集","闇戦之集"),l("同色無抗行処","無抗行処"),t}(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.generate_example=o.calculate_hands_and_score_from_pieces=o.hand_to_score=o.toObtainablePieces2=void 0,o.toObtainablePieces2={黒兵:{color:"黒",prof:"兵"},赤兵:{color:"赤",prof:"兵"},黒弓:{color:"黒",prof:"弓"},黒車:{color:"黒",prof:"車"},黒虎:{color:"黒",prof:"虎"},黒馬:{color:"黒",prof:"馬"},黒筆:{color:"黒",prof:"筆"},黒巫:{color:"黒",prof:"巫"},黒将:{color:"黒",prof:"将"},赤弓:{color:"赤",prof:"弓"},赤車:{color:"赤",prof:"車"},赤虎:{color:"赤",prof:"虎"},赤馬:{color:"赤",prof:"馬"},赤筆:{color:"赤",prof:"筆"},赤巫:{color:"赤",prof:"巫"},赤将:{color:"赤",prof:"将"},黒王:{color:"黒",prof:"王"},赤王:{color:"赤",prof:"王"},黒船:{color:"黒",prof:"船"},赤船:{color:"赤",prof:"船"}},o.hand_to_score={無抗行処:50,同色無抗行処:52,筆兵無傾:10,同色筆兵無傾:12,地心:7,同色地心:9,馬弓兵:5,同色馬弓兵:7,行行:5,同色行行:7,王:5,獣:3,同色獣:5,戦集:3,同色戦集:5,助友:3,同色助友:5,闇戦之集:3,同色闇戦之集:5,皇再来:-3,撃皇:-5},o.calculate_hands_and_score_from_pieces=function(e){var t=function(e){for(var t=e.map((function(e){return o.toObtainablePieces2[e]})),i={兵:{黒:0,赤:0},弓:{黒:0,赤:0},車:{黒:0,赤:0},虎:{黒:0,赤:0},馬:{黒:0,赤:0},筆:{黒:0,赤:0},巫:{黒:0,赤:0},将:{黒:0,赤:0},王:{黒:0,赤:0},船:{黒:0,赤:0}},a=0;a<t.length;a++)i[t[a].prof][t[a].color]++;var s=[];return i["兵"]["黒"]>8&&s.push("黒兵"),i["兵"]["赤"]>8&&s.push("赤兵"),i["弓"]["黒"]>2&&s.push("黒弓"),i["弓"]["赤"]>2&&s.push("赤弓"),i["車"]["黒"]>2&&s.push("黒車"),i["車"]["赤"]>2&&s.push("赤車"),i["虎"]["黒"]>2&&s.push("黒虎"),i["虎"]["赤"]>2&&s.push("赤虎"),i["馬"]["黒"]>2&&s.push("黒馬"),i["馬"]["赤"]>2&&s.push("赤馬"),i["筆"]["黒"]>2&&s.push("黒筆"),i["筆"]["赤"]>2&&s.push("赤筆"),i["巫"]["黒"]>2&&s.push("黒巫"),i["巫"]["赤"]>2&&s.push("赤巫"),i["将"]["黒"]>2&&s.push("黒将"),i["将"]["赤"]>2&&s.push("赤将"),i["王"]["黒"]>1&&s.push("黒王"),i["王"]["赤"]>1&&s.push("赤王"),i["船"]["黒"]>1&&s.push("黒船"),i["船"]["赤"]>1&&s.push("赤船"),s.length>0?{too_many:s}:r(n(i))}(e);return Array.isArray(t)?{error:!1,score:t.map((function(e){return o.hand_to_score[e]})).reduce((function(e,o){return e+o}),0),hands:t}:{error:!0,too_many:t.too_many}},o.generate_example=function(e){for(var o,r=["黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","黒王","赤王","黒船","赤船"],n=r.length-1;n>0;n--){var i=Math.floor(Math.random()*(n+1));o=t([r[i],r[n]],2),r[n]=o[0],r[i]=o[1]}return r.slice(0,e)}},9673(e,o,t){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(o,t);n&&!("get"in n?!o.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,n)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),n=this&&this.__exportStar||function(e,o){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(o,t)||r(o,e,t)};Object.defineProperty(o,"__esModule",{value:!0}),n(t(2664),o),n(t(1316),o),n(t(5598),o),n(t(2421),o),n(t(9641),o),n(t(8481),o),n(t(7728),o),n(t(3323),o),n(t(3262),o),n(t(4761),o),n(t(6667),o),n(t(1451),o),n(t(1168),o),n(t(3822),o),n(t(9172),o),n(t(1506),o),n(t(7632),o),n(t(3296),o),n(t(8065),o),n(t(8976),o),n(t(9588),o),n(t(5285),o)},9784(e,o){"use strict";function t(e){if(e%1!=0)throw new Error("non-integer");if(e>=200){const o=e%100==0?[]:r(e%100);return[...r(Math.floor(e/100)),"num100",...o]}if(e>=100)return["num100",...e%100==0?[]:t(e%100)];if(e<0)return["neg",...t(-e)];if(0==e)return["num00"];const o=e%10==0?[]:["num0"+e%10];return e>=20?[`num0${Math.floor(e/10)}`,"num10",...o]:e>=10?["num10",...o]:o}function r(e){if(e%1!=0)throw new Error("non-integer");if(e>=100)throw new Error("100 or more detected in toDigitsSub");if(e<=0)throw new Error("0 or less detected in toDigitsSub");if(e%10==0){if(e>=20)return[`num0${Math.floor(e/10)}`,"num10"];if(10==e)return["num10"];throw new Error("cannot happen")}{const o="num0"+e%10;return e>=20?[`num0${Math.floor(e/10)}`,o]:e>=10?["num10",o]:[o]}}Object.defineProperty(o,"__esModule",{value:!0}),o.toDigitsLinzklar=function(e){return t(e).map((function(e){return{neg:"下",num00:"無",num01:"一",num02:"二",num03:"三",num04:"四",num05:"五",num06:"六",num07:"七",num08:"八",num09:"九",num10:"十",num100:"百"}[e]}))}}},o={};function t(r){var n=o[r];if(void 0!==n)return n.exports;var i=o[r]={exports:{}};return e[r].call(i.exports,i,i.exports,t),i.exports}t.d=(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(4068),t(7973)})();